<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>flap.plot</title>
    <link rel="stylesheet" href="../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for flap.plot</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Sat May 18 18:37:06 2019</span>

<span class="sd">@author: Zoletnik</span>
<span class="sd">@coauthor: Lampert</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&quot;&quot;&quot; Notes on how to use subplots.</span>
<span class="sd">    plt.gca() returns the current subplot</span>
<span class="sd">    to create sub-sub plots use</span>
<span class="sd">        gs = gridspec.GridSpecFromSubplotSpec(2, 2, subplot_spec=gs0)</span>
<span class="sd">    Then create the figures (axes):</span>
<span class="sd">        ax1 = plt.subplot(gs[0, :])</span>
<span class="sd">    Use ax1.plot and other calls to plot onto the figure.</span>
<span class="sd">    </span>
<span class="sd">    Note on FLAP plotting mechanism.</span>
<span class="sd">    - The axes paramater of plot() can be the following:</span>
<span class="sd">        string: Name of a coordinate or __Data__. This latter means the data in the data object is on the axis.</span>
<span class="sd">        float value: Constant</span>
<span class="sd">        data object: Enables plotting one data object as a function of another</span>
<span class="sd">    - When a plot is made parameters are recorded in PlotID. This later enables overplotting</span>
<span class="sd">      using the same axes. When the axis are incompatble in overplotting they can be forced. As </span>
<span class="sd">      a link to the data objects involved in the plot are also recorded it is also possible</span>
<span class="sd">      to regenerate the plot when megnified and &#39;All points&#39; is False. </span>
<span class="sd">    - If axis are forced or no axis name and unit is avalilable (like in constant) overplotting is possible</span>
<span class="sd">      without forcing. If forced the name and unit of the incompatible axes will be set to &#39;&#39;.</span>
<span class="sd">    - Constants are considered as unit-less, therefore they don&#39;t need forcing.</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>    

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>
<span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="kn">import</span> <span class="n">Button</span><span class="p">,</span> <span class="n">Slider</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cv2</span>
    <span class="n">cv2_presence</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OpenCV is not present on the computer. Video saving is not available.&#39;</span><span class="p">)</span>
    <span class="n">cv2_presence</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1">#from .coordinate import *</span>
<span class="c1">#from .tools import *</span>
<span class="kn">import</span> <span class="nn">flap.config</span>
<span class="kn">import</span> <span class="nn">flap.tools</span>
<span class="kn">import</span> <span class="nn">flap.coordinate</span>

<span class="k">global</span> <span class="n">act_plot_id</span><span class="p">,</span> <span class="n">gca_invalid</span>

<div class="viewcode-block" id="PddType"><a class="viewcode-back" href="../../plot.xhtml#flap.plot.PddType">[docs]</a><span class="k">class</span> <span class="nc">PddType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">Coordinate</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Constant</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Data</span> <span class="o">=</span> <span class="mi">2</span></div>
    
<div class="viewcode-block" id="PlotDataDescription"><a class="viewcode-back" href="../../plot.xhtml#flap.plot.PlotDataDescription">[docs]</a><span class="k">class</span> <span class="nc">PlotDataDescription</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Plot axis description for use in PlotID() and plot(). </span>
<span class="sd">        data_object: The data object from which the data for this coordinate originates. This may</span>
<span class="sd">                     be None if the data is constant.</span>
<span class="sd">        data_type: PddType</span>
<span class="sd">                   PddType.Coordinate: A coordinate in data_object. </span>
<span class="sd">                                 self.value is a flap.Coordinate object. </span>
<span class="sd">                   PddType.Constant: A float constant, stored in value.</span>
<span class="sd">                   PddType.Data: The data in self.data_object. </span>
<span class="sd">        value: Value, see above</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_object</span> <span class="o">=</span> <span class="n">data_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span></div>
        
<div class="viewcode-block" id="axes_to_pdd_list"><a class="viewcode-back" href="../../plot.xhtml#flap.plot.axes_to_pdd_list">[docs]</a><span class="k">def</span> <span class="nf">axes_to_pdd_list</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">axes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert a plot() axes parameter to a list of PlotAxisDescription and axes list for PlotID</span>
<span class="sd">    d: data object</span>
<span class="sd">    axes: axes parameter of plot()</span>
<span class="sd">    </span>
<span class="sd">    return pdd_list, ax_list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[],[]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_axes</span> <span class="o">=</span> <span class="n">axes</span>
    
    <span class="n">pdd_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">_axes</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ax</span> <span class="o">!=</span> <span class="s1">&#39;__Data__&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_coordinate_object</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
                <span class="n">pdd</span> <span class="o">=</span> <span class="n">PlotDataDescription</span><span class="p">(</span><span class="n">data_type</span><span class="o">=</span><span class="n">PddType</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">,</span>
                                          <span class="n">data_object</span><span class="o">=</span><span class="n">d</span><span class="p">,</span>
                                          <span class="n">value</span><span class="o">=</span><span class="n">coord</span>
                                          <span class="p">)</span>
                <span class="n">axx</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">unit</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data available for plotting.&quot;</span><span class="p">)</span>
                <span class="n">pdd</span> <span class="o">=</span> <span class="n">PlotDataDescription</span><span class="p">(</span><span class="n">data_type</span><span class="o">=</span><span class="n">PddType</span><span class="o">.</span><span class="n">Data</span><span class="p">,</span>
                                          <span class="n">data_object</span><span class="o">=</span><span class="n">d</span>
                                          <span class="p">)</span>
                <span class="n">axx</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">data_unit</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data available for axis.&quot;</span><span class="p">)</span>
            <span class="n">pdd</span> <span class="o">=</span> <span class="n">PlotDataDescription</span><span class="p">(</span><span class="n">data_type</span><span class="o">=</span><span class="n">PddType</span><span class="o">.</span><span class="n">Data</span><span class="p">,</span>
                                      <span class="n">data_object</span><span class="o">=</span><span class="n">ax</span>
                                      <span class="p">)</span>  
            <span class="n">axx</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">data_unit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid axis description.&quot;</span><span class="p">)</span>
            <span class="n">pdd</span> <span class="o">=</span> <span class="n">PlotDataDescription</span><span class="p">(</span><span class="n">data_type</span><span class="o">=</span><span class="n">PddType</span><span class="o">.</span><span class="n">Constant</span><span class="p">,</span>
                                      <span class="n">value</span><span class="o">=</span><span class="n">val</span>
                                      <span class="p">)</span>
            <span class="n">axx</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">Unit</span><span class="p">()</span>
        <span class="n">pdd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdd</span><span class="p">)</span>
        <span class="n">ax_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pdd_list</span><span class="p">,</span><span class="n">ax_list</span></div>

<span class="k">class</span> <span class="nc">PlotAnimation</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">tdata</span><span class="p">,</span> <span class="n">xdata_range</span><span class="p">,</span> <span class="n">ydata_range</span><span class="p">,</span>
                 <span class="n">cmap_obj</span><span class="p">,</span> <span class="n">contour_levels</span><span class="p">,</span> <span class="n">coord_t</span><span class="p">,</span> <span class="n">coord_x</span><span class="p">,</span>
                 <span class="n">coord_y</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span>
                 <span class="n">zrange</span><span class="p">,</span> <span class="n">image_like</span><span class="p">,</span> <span class="n">plot_options</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">plot_id</span><span class="p">,</span> <span class="n">gs</span><span class="p">):</span>
   
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span> <span class="o">=</span> <span class="n">ax_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">contour_levels</span> <span class="o">=</span> <span class="n">contour_levels</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap_obj</span> <span class="o">=</span> <span class="n">cmap_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_t</span> <span class="o">=</span> <span class="n">coord_t</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_x</span> <span class="o">=</span> <span class="n">coord_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_y</span> <span class="o">=</span> <span class="n">coord_y</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">current_frame</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">plot_id</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">gs</span> <span class="o">=</span> <span class="n">gs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_like</span> <span class="o">=</span> <span class="n">image_like</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_id</span> <span class="o">=</span> <span class="n">plot_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_options</span> <span class="o">=</span> <span class="n">plot_options</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="mf">40.</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">tdata</span> <span class="o">=</span> <span class="n">tdata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span> <span class="o">=</span> <span class="n">xdata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ydata</span> <span class="o">=</span> <span class="n">ydata</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">xdata_range</span> <span class="o">=</span> <span class="n">xdata_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ydata_range</span> <span class="o">=</span> <span class="n">ydata_range</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">xrange</span> <span class="o">=</span> <span class="n">xrange</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yrange</span> <span class="o">=</span> <span class="n">yrange</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zrange</span> <span class="o">=</span> <span class="n">zrange</span>

        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contour_levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contour_levels</span> <span class="o">=</span> <span class="mi">255</span>
            
    <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c1">#These lines do the coordinate unit conversion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[:]</span><span class="o">=</span><span class="mf">1.</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unit_length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">unit_length</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only three units are allowed for the three coordinates.&#39;</span><span class="p">)</span>
            <span class="n">unit_conversion_coeff</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">plot_unit_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">index_data_unit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">plot_unit_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">index_data_unit</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                        <span class="n">data_coordinate_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">index_data_unit</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span>
                        <span class="n">plot_coordinate_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">][</span><span class="n">plot_unit_name</span><span class="p">]</span>
                        <span class="n">unit_conversion_coeff</span><span class="p">[</span><span class="n">plot_unit_name</span><span class="p">]</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">unit_conversion</span><span class="p">(</span><span class="n">original_unit</span><span class="o">=</span><span class="n">data_coordinate_unit</span><span class="p">,</span>
                                                                                        <span class="n">new_unit</span><span class="o">=</span><span class="n">plot_coordinate_unit</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index_axes</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">index_axes</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="n">index_axes</span><span class="p">]</span><span class="o">=</span><span class="n">unit_conversion_coeff</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">index_axes</span><span class="p">]]</span>
        
        <span class="n">pause_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_id</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span><span class="o">.</span><span class="n">add_axes</span><span class="p">((</span><span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.94</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">pause_ax</span><span class="p">,</span> <span class="s1">&#39;Pause&#39;</span><span class="p">,</span> <span class="n">hovercolor</span><span class="o">=</span><span class="s1">&#39;0.975&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause_button</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pause_animation</span><span class="p">)</span>
        <span class="n">pause_ax</span><span class="o">.</span><span class="n">_button</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pause_button</span>
        
        <span class="n">reset_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_id</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span><span class="o">.</span><span class="n">add_axes</span><span class="p">((</span><span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">))</span>
        <span class="n">reset_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">reset_ax</span><span class="p">,</span> <span class="s1">&#39;Reset&#39;</span><span class="p">,</span> <span class="n">hovercolor</span><span class="o">=</span><span class="s1">&#39;0.975&#39;</span><span class="p">)</span>
        <span class="n">reset_button</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reset_animation</span><span class="p">)</span>
        <span class="n">reset_ax</span><span class="o">.</span><span class="n">_button</span><span class="o">=</span><span class="n">reset_button</span>
        
        <span class="n">slow_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_id</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span><span class="o">.</span><span class="n">add_axes</span><span class="p">((</span><span class="mf">0.88</span><span class="p">,</span> <span class="mf">0.94</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slow_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">slow_ax</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1000.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="o">/</span><span class="mf">0.8</span><span class="p">)))</span><span class="o">+</span><span class="s1">&#39;fps&#39;</span><span class="p">,</span> <span class="n">hovercolor</span><span class="o">=</span><span class="s1">&#39;0.975&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slow_button</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_slow_animation</span><span class="p">)</span>
        <span class="n">slow_ax</span><span class="o">.</span><span class="n">_button</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">slow_button</span>
        
        <span class="n">speed_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_id</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span><span class="o">.</span><span class="n">add_axes</span><span class="p">((</span><span class="mf">0.88</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">speed_ax</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1000.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="o">*</span><span class="mf">0.8</span><span class="p">)))</span><span class="o">+</span><span class="s1">&#39;fps&#39;</span><span class="p">,</span> <span class="n">hovercolor</span><span class="o">=</span><span class="s1">&#39;0.975&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_button</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_speed_animation</span><span class="p">)</span>
        <span class="n">speed_ax</span><span class="o">.</span><span class="n">_button</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">speed_button</span>
        
        
        <span class="n">slider_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_id</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span><span class="o">.</span><span class="n">add_axes</span><span class="p">((</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.94</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_slider</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">slider_ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                  <span class="n">valmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
                                  <span class="n">valmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                  <span class="n">valinit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_animation</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_id</span><span class="o">.</span><span class="n">base_subplot</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_act</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="c1">#The following lines set the axes to be equal if the units of the axes-to-be-plotted are the same</span>

        <span class="n">axes_coordinate_decrypt</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i_axes</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j_coordinate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">j_coordinate</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i_axes</span><span class="p">]):</span>
                    <span class="n">axes_coordinate_decrypt</span><span class="p">[</span><span class="n">i_axes</span><span class="p">]</span><span class="o">=</span><span class="n">j_coordinate</span>
        <span class="k">for</span> <span class="n">i_check</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">))</span>        <span class="p">:</span>
            <span class="k">for</span> <span class="n">j_check</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_check</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">axes_coordinate_decrypt</span><span class="p">[</span><span class="n">i_check</span><span class="p">]]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">axes_coordinate_decrypt</span><span class="p">[</span><span class="n">j_check</span><span class="p">]]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax_act</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
                    
            
        
        <span class="n">time_index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>
        <span class="n">time_index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_t</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">time_index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">time_index</span><span class="p">)</span>
        
        <span class="n">act_ax_pos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_act</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="n">slider_ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">act_ax_pos</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span><span class="mf">0.94</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.04</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zrange</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zrange</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
<span class="c1">#        if (self.zrange is None):</span>
<span class="c1">#            self.vmin = np.nanmin(self.d.data[time_index])</span>
<span class="c1">#            self.vmax = np.nanmax(self.d.data[time_index])</span>
<span class="c1">#        else:</span>
<span class="c1">#            self.vmin = self.zrange[0]</span>
<span class="c1">#            self.vmax = self.zrange[1]</span>


        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vmin</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid z range.&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Log z&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;z range[0] cannot be negative or zero for logarithmic scale.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">subs</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="kc">None</span>
                
            
        <span class="n">_plot_opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_like</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="c1">#There is a problem here, but I cant find it. Image is rotated with 90degree here, but not in anim-image.</span>
                <span class="c1">#if (self.coord_x.dimension_list[0] == 0):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_index</span><span class="p">]),</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_index</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">)</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata_range</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ydata_range</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                                <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap_obj</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Aspect ratio&#39;</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Interpolation&#39;</span><span class="p">],</span>
                                <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>            
                <span class="k">del</span> <span class="n">im</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                <span class="c1">#xgrid, ygrid = flap.tools.grid_to_box(self.xdata[0,:,:],self.ydata[0,:,:]) #Same issue, time is not necessarily the first flap.coordinate.</span>
                <span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_to_box</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">ydata</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#Same issue, time is not necessarily the first flap.coordinate.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_to_box</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">ydata</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
            <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_index</span><span class="p">]),</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span><span class="n">ygrid</span><span class="p">,</span><span class="n">im</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span>
                                  <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
            <span class="k">del</span> <span class="n">im</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">xdata_range</span><span class="o">=</span><span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ydata_range</span><span class="o">=</span><span class="kc">None</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Colorbar&#39;</span><span class="p">]):</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_act</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">data_unit</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c1">#EFIT overplot feature implementation:</span>
            <span class="c1">#It needs to be more generalied in the future as the coordinates are not necessarily in this order: [time_index,spat_index]</span>
            <span class="c1">#This needs to be cross-checked with the time array&#39;s dimensions wherever there is a call for a certain index.</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;EFIT options&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;EFIT options&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            
            <span class="n">default_efit_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Plot limiter&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="s1">&#39;Limiter X&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="s1">&#39;Limiter Y&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="s1">&#39;Limiter 2D&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="s1">&#39;Limiter color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;Plot separatrix&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="s1">&#39;Separatrix X&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="s1">&#39;Separatrix Y&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="s1">&#39;Separatrix 2D&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="s1">&#39;Separatrix color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;Plot flux&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="s1">&#39;Flux XY&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                  <span class="s1">&#39;Flux nlevel&#39;</span><span class="p">:</span> <span class="mi">51</span><span class="p">}</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">merge_options</span><span class="p">(</span><span class="n">default_efit_options</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;EFIT options&#39;</span><span class="p">],</span><span class="n">data_source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">data_source</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;limiter&#39;</span><span class="p">:</span>   <span class="p">{</span><span class="s1">&#39;Time&#39;</span><span class="p">:[],</span><span class="s1">&#39;Data&#39;</span><span class="p">:[]},</span>
                            <span class="s1">&#39;separatrix&#39;</span><span class="p">:{</span><span class="s1">&#39;Time&#39;</span><span class="p">:[],</span><span class="s1">&#39;Data&#39;</span><span class="p">:[]},</span>
                            <span class="s1">&#39;flux&#39;</span><span class="p">:</span>      <span class="p">{</span><span class="s1">&#39;Time&#39;</span><span class="p">:[],</span><span class="s1">&#39;Data&#39;</span><span class="p">:[]}}</span>
            
            <span class="k">for</span> <span class="n">setting</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;limiter&#39;</span><span class="p">,</span><span class="s1">&#39;separatrix&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="s1">&#39;Plot &#39;</span><span class="o">+</span><span class="n">setting</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; X&#39;</span><span class="p">])</span> <span class="ow">and</span>
                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; Y&#39;</span> <span class="p">]))</span> <span class="ow">or</span>
                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; 2D&#39;</span><span class="p">])):</span>
                    
                        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; X&#39;</span><span class="p">])</span> <span class="ow">and</span>
                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; Y&#39;</span><span class="p">])):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">R_object</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">get_data_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; X&#39;</span><span class="p">],</span><span class="n">exp_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The objects &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; X&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; cannot be read.&quot;</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">Z_object</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">get_data_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; Y&#39;</span><span class="p">],</span><span class="n">exp_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The objects &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; Y&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; cannot be read.&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R_object</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z_object</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The &quot;</span><span class="o">+</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; Y&#39;</span><span class="o">+</span><span class="s2">&quot; data is not 1D. Use 2D or modify data reading.&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">R_object</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">Z_object</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">R_object</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#TIME IS NOT ALWAYS THE FIRST COORDINATE, ELLIPSIS CHANGE SHOULD BE IMPLEMENTED</span>
                        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; XY&#39;</span><span class="p">]):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">R_object</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">get_data_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; 2D&#39;</span><span class="p">],</span><span class="n">exp_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;  2D data is not available. FLAP data object needs to be read first.&#39;</span><span class="p">)</span>  
                            <span class="k">if</span> <span class="n">R_object</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">R_object</span><span class="o">.</span><span class="n">data</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span><span class="n">R_object</span><span class="o">.</span><span class="n">data</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; XY data needs to be in the format [n_time,n_points,2 (xy)&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">R_object</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#TIME IS NOT ALWAYS THE FIRST COORDINATE, ELLIPSIS CHANGE SHOULD BE IMPLEMENTED</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Both &#39;</span><span class="o">+</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; X and&#39;</span><span class="o">+</span>
                                             <span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; Y or &#39;</span><span class="o">+</span>
                                             <span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; 2D need to be set.&#39;</span><span class="p">)</span>
                        
                        <span class="k">for</span> <span class="n">index_coordinate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">index_coordinate</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="ow">and</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">index_coordinate</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;Time&#39;</span><span class="p">)):</span>
                                <span class="n">coordinate_index</span><span class="o">=</span><span class="n">index_coordinate</span>
                        <span class="c1">#Spatial unit translation (mm vs m usually)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">R_object</span><span class="o">.</span><span class="n">data_unit</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">coordinate_index</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">coeff_efit_spatial</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">spatial_unit_translation</span><span class="p">(</span><span class="n">R_object</span><span class="o">.</span><span class="n">data_unit</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time unit translation cannot be made. Check the time unit of the object.&quot;</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">coeff_data_spatial</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">spatial_unit_translation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">coordinate_index</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Spatial unit translation cannot be made. Check the time unit of the object.&quot;</span><span class="p">)</span>
                            <span class="c1">#print(&#39;Spatial unit translation factor: &#39;+str(coeff_efit_spatial/coeff_data_spatial))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">coeff_efit_spatial</span><span class="o">/</span><span class="n">coeff_data_spatial</span>
                        <span class="c1">#Time translation (usually ms vs s)</span>
                        <span class="k">for</span> <span class="n">index_time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">index_time</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Time&#39;</span><span class="p">):</span>
                                <span class="n">time_index_data</span><span class="o">=</span><span class="n">index_time</span>
                                
                        <span class="k">for</span> <span class="n">index_time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">index_time</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Time&#39;</span><span class="p">):</span>
                                <span class="n">time_index_efit</span><span class="o">=</span><span class="n">index_time</span>      
                        
                        <span class="k">if</span> <span class="p">(</span><span class="n">R_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">time_index_efit</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">time_index_data</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">coeff_efit_time</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">time_unit_translation</span><span class="p">(</span><span class="n">R_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">time_index_efit</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time unit translation cannot be made. Check the time unit of the object.&quot;</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">coeff_data_time</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">time_unit_translation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">time_index_data</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time unit translation cannot be made. Check the time unit of the object.&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">coeff_efit_time</span><span class="o">/</span><span class="n">coeff_data_time</span>         
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; keywords are not set for the data objects.&#39;</span><span class="p">)</span>
                        
                    <span class="c1">#Interpolating EFIT data for the time vector of the data    </span>
                    <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[])</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[])):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Data resampled&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                        <span class="k">for</span> <span class="n">index_xy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">index_coordinate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Data resampled&#39;</span><span class="p">][</span><span class="n">index_xy</span><span class="p">,:,</span><span class="n">index_coordinate</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span>
                                                                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="n">index_xy</span><span class="p">,:,</span><span class="n">index_coordinate</span><span class="p">])</span>
                                
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="s1">&#39;Plot flux&#39;</span><span class="p">]):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">flux_object</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">get_data_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="s1">&#39;Flux XY&#39;</span><span class="p">],</span><span class="n">exp_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Flux  XY data is not available. FLAP data object needs to be read first.&#39;</span><span class="p">)</span>  
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flux_object</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Flux XY data needs to be a 3D matrix (r,z,t), not necessarily in this order.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">flux_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;Time&#39;</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Time should be the first coordinate in the flux data object.&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">flux_object</span><span class="o">.</span><span class="n">data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">flux_object</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#TIME IS NOT ALWAYS THE FIRST COORDINATE, ELLIPSIS CHANGE SHOULD BE IMPLEMENTED</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;X coord&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">flux_object</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="n">flux_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Y coord&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">flux_object</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="n">flux_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="k">for</span> <span class="n">index_coordinate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">index_coordinate</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">index_coordinate</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;Time&#39;</span><span class="p">)):</span>
                        <span class="n">coordinate_index</span><span class="o">=</span><span class="n">index_coordinate</span>
                <span class="c1">#Spatial unit translation (mm vs m usually)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">flux_object</span><span class="o">.</span><span class="n">data_unit</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">coordinate_index</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">coeff_efit_spatial</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">spatial_unit_translation</span><span class="p">(</span><span class="n">flux_object</span><span class="o">.</span><span class="n">data_unit</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time unit translation cannot be made. Check the time unit of the object.&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">coeff_data_spatial</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">spatial_unit_translation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">coordinate_index</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Spatial unit translation cannot be made. Check the time unit of the object.&quot;</span><span class="p">)</span>
                    <span class="c1">#print(&#39;Spatial unit translation factor: &#39;+str(coeff_efit_spatial/coeff_data_spatial))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;X coord&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">coeff_efit_spatial</span><span class="o">/</span><span class="n">coeff_data_spatial</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Y coord&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">coeff_efit_spatial</span><span class="o">/</span><span class="n">coeff_data_spatial</span>
                
                <span class="c1">#Time translation (usually ms vs s)</span>
                <span class="k">for</span> <span class="n">index_time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">index_time</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Time&#39;</span><span class="p">):</span>
                        <span class="n">time_index_data</span><span class="o">=</span><span class="n">index_time</span>
                        
                <span class="k">for</span> <span class="n">index_time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">flux_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">index_time</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Time&#39;</span><span class="p">):</span>
                        <span class="n">time_index_efit</span><span class="o">=</span><span class="n">index_time</span>      
                
                <span class="k">if</span> <span class="p">(</span><span class="n">flux_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">time_index_efit</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">time_index_data</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">coeff_efit_time</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">time_unit_translation</span><span class="p">(</span><span class="n">flux_object</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">time_index_efit</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time unit translation cannot be made. Check the time unit of the object.&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">coeff_data_time</span><span class="o">=</span><span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">time_unit_translation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">time_index_data</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time unit translation cannot be made. Check the time unit of the object.&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">coeff_efit_time</span><span class="o">/</span><span class="n">coeff_data_time</span>         
                
                <span class="c1">#Interpolating EFIT data for the time vector of the data    </span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[])</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[])):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Data resampled&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;X coord resampled&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;X coord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;X coord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Y coord resampled&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Y coord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Y coord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                    
                    <span class="k">for</span> <span class="n">index_x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="k">for</span> <span class="n">index_y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Data resampled&#39;</span><span class="p">][:,</span><span class="n">index_x</span><span class="p">,</span><span class="n">index_y</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span>
                                                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Data&#39;</span><span class="p">][:,</span><span class="n">index_x</span><span class="p">,</span><span class="n">index_y</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;X coord resampled&#39;</span><span class="p">][:,</span><span class="n">index_x</span><span class="p">,</span><span class="n">index_y</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span>
                                                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;X coord&#39;</span><span class="p">][:,</span><span class="n">index_x</span><span class="p">,</span><span class="n">index_y</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Y coord resampled&#39;</span><span class="p">][:,</span><span class="n">index_x</span><span class="p">,</span><span class="n">index_y</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span>
                                                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Y coord&#39;</span><span class="p">][:,</span><span class="n">index_x</span><span class="p">,</span><span class="n">index_y</span><span class="p">])</span>
                            
            
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>        
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">new_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">new_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Log x&#39;</span><span class="p">]):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Log y&#39;</span><span class="p">]):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">]:</span>
                <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                <span class="n">time_coeff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_t</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span>
            <span class="n">time_coeff</span><span class="o">=</span><span class="mf">1.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_t</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span>
            <span class="n">time_coeff</span><span class="o">=</span><span class="mf">1.</span>
        <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; @ &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_t</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;=&#39;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:10.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">time_coeff</span><span class="p">)</span><span class="o">+</span>\
                <span class="s1">&#39; [&#39;</span><span class="o">+</span><span class="n">time_unit</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
                              
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_plot</span><span class="p">,</span> 
                                            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">),</span>
                                            <span class="n">interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span><span class="n">blit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">animate_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">it</span><span class="p">):</span>
        
        <span class="n">time_index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>
        <span class="n">time_index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_t</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">it</span>
        <span class="n">time_index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">time_index</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">eventson</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_slider</span><span class="o">.</span><span class="n">eventson</span> <span class="o">=</span> <span class="kc">True</span>       
        
        <span class="bp">self</span><span class="o">.</span><span class="n">current_frame</span> <span class="o">=</span> <span class="n">it</span>
            
        <span class="n">plot_opt</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_options</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_act</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_like</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span> 
<span class="c1">#                if (self.coord_x.dimension_list[0] == 0):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_index</span><span class="p">]),</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_index</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata_range</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ydata_range</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                           <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap_obj</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span>
                           <span class="n">aspect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Aspect ratio&#39;</span><span class="p">],</span>
                           <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Interpolation&#39;</span><span class="p">],</span>
                           <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">plot_opt</span><span class="p">)</span>            
                <span class="k">del</span> <span class="n">im</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ydata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_to_box</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="p">[</span><span class="n">time_index</span><span class="p">,:,:]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">ydata</span><span class="p">[</span><span class="n">time_index</span><span class="p">,:,:]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#Same issue, time is not necessarily the first flap.coordinate.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_to_box</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">ydata</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_index</span><span class="p">]),</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span><span class="n">ygrid</span><span class="p">,</span><span class="n">im</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span><span class="p">,</span>
                               <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">,</span><span class="o">**</span><span class="n">plot_opt</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
            <span class="k">del</span> <span class="n">im</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;EFIT options&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;EFIT options&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>        
            <span class="k">for</span> <span class="n">setting</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;limiter&#39;</span><span class="p">,</span><span class="s1">&#39;separatrix&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="s1">&#39;Plot &#39;</span><span class="o">+</span><span class="n">setting</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax_act</span><span class="o">.</span><span class="n">set_autoscale_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Data resampled&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">it</span><span class="p">,:],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="n">setting</span><span class="p">][</span><span class="s1">&#39;Data resampled&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">it</span><span class="p">,:],</span>
                                  <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="n">setting</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; color&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="s1">&#39;Plot flux&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax_act</span><span class="o">.</span><span class="n">set_autoscale_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1">#im = plt.contour(self.efit_data[&#39;flux&#39;][&#39;X coord&#39;][it,:,:],</span>
                <span class="c1">#                 self.efit_data[&#39;flux&#39;][&#39;Y coord&#39;][it,:,:],</span>
                <span class="c1">#                 self.efit_data[&#39;flux&#39;][&#39;Data resampled&#39;][it,:,:],</span>
                <span class="c1">#                 levels=self.efit_options[&#39;Flux nlevel&#39;])</span>

                <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;X coord resampled&#39;</span><span class="p">][</span><span class="n">it</span><span class="p">,:,:]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Y coord resampled&#39;</span><span class="p">][</span><span class="n">it</span><span class="p">,:,:]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">efit_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">][</span><span class="s1">&#39;Data resampled&#39;</span><span class="p">][</span><span class="n">it</span><span class="p">,:,:],</span>
                                 <span class="n">levels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">efit_options</span><span class="p">[</span><span class="s1">&#39;Flux nlevel&#39;</span><span class="p">])</span>
                
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax_act</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">xrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax_act</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>        
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">new_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">new_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">]:</span>
                <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Plot units&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                <span class="n">time_coeff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_t</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span>
            <span class="n">time_coeff</span><span class="o">=</span><span class="mf">1.</span>
            
        <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; @ &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_t</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;=&#39;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:10.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">[</span><span class="n">it</span><span class="p">]</span><span class="o">*</span><span class="n">time_coeff</span><span class="p">)</span><span class="o">+</span>\
                <span class="s1">&#39; [&#39;</span><span class="o">+</span><span class="n">time_unit</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_act</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_reset_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="mf">40.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_id</span><span class="o">.</span><span class="n">figure</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_plot</span><span class="p">,</span> 
                                       <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">),</span><span class="n">interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span><span class="n">blit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="k">def</span> <span class="nf">_pause_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pause</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anim</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pause_button</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&quot;Pause&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anim</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pause_button</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&quot;Start&quot;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_set_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="n">frame</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_unit_conversion</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">time</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_id</span><span class="o">.</span><span class="n">figure</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_plot</span><span class="p">,</span> 
                                            <span class="n">frames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                            <span class="n">interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span><span class="n">blit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="k">def</span> <span class="nf">_slow_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="o">/</span><span class="mf">0.8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_id</span><span class="o">.</span><span class="n">figure</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_plot</span><span class="p">,</span> 
                                            <span class="n">frames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_frame</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                            <span class="n">interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span><span class="n">blit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_button</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1000.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="o">*</span><span class="mf">0.8</span><span class="p">)))</span><span class="o">+</span><span class="s1">&#39;fps&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slow_button</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1000.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="o">/</span><span class="mf">0.8</span><span class="p">)))</span><span class="o">+</span><span class="s1">&#39;fps&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="k">def</span> <span class="nf">_speed_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="o">*</span><span class="mf">0.8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_id</span><span class="o">.</span><span class="n">figure</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate_plot</span><span class="p">,</span> 
                                            <span class="n">frames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_frame</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tdata</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                            <span class="n">interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span><span class="n">blit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed_button</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1000.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="o">*</span><span class="mf">0.8</span><span class="p">)))</span><span class="o">+</span><span class="s1">&#39;fps&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slow_button</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">1000.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="o">/</span><span class="mf">0.8</span><span class="p">)))</span><span class="o">+</span><span class="s1">&#39;fps&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anim</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">False</span>
            
<span class="k">class</span> <span class="nc">PlotID</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The figure number where the plto resides</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The subplot containing the whole plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_subplot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The plot type string </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Subtype is dependent on the plot type. It marks various versions, e.g. real-complex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_subtype</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Number of plot calls which generated this</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_plots</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># The axes list. Each element is a flap.Unit and describes one axis of the plot.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The description of the axis data. This is a list of self.number_of_plots lists. Each inner list </span>
        <span class="c1"># is a list of PlotDataDescriptions. </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># The list of Axes which can be used for plotting into the individual plots. If there is only a single</span>
        <span class="c1"># plot self.base_subplot is the same as plt_axis_list[0]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plt_axis_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># These are a list of the options to plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clears the parameters of the plot, but does not clear the</span>
<span class="sd">        base_subplot and figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_subtype</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_plots</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plt_axis_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
        

<span class="c1">#    def __del__(self):</span>
<span class="c1">#        if (self.plt_axis_list is not None):</span>
<span class="c1">#            for ax in self.plt_axis_list:</span>
<span class="c1">#                ax.remove()</span>
                
    <span class="k">def</span> <span class="nf">check_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">d</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks whether the required plot axes are correct, present and compatible with the self PlotID. </span>
<span class="sd">            In case of problems raises ValueError.</span>
<span class="sd">        INPUT:</span>
<span class="sd">            d: data object</span>
<span class="sd">            axes: List of the required axes or None as input to plot() </span>
<span class="sd">            clear: (bool) If True the plot will be cleared, therefore the axes in the PlotID are irrelevant.</span>
<span class="sd">            default_axes: The default axes desired for this type of plot. (strings)</span>
<span class="sd">            force: (bool) Force accept incompatibe axes</span>
<span class="sd">        Return value:</span>
<span class="sd">            pdd_list, ax_list</span>
<span class="sd">            pdd_list: list of PlotDataDescription objects which can be used to generate the plot.</span>
<span class="sd">            ax_list: axis list which can be put into axes in self.  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_axes</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_axes</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Converting to PDD and axes list</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdd_list</span><span class="p">,</span><span class="n">ax_list</span> <span class="o">=</span> <span class="n">axes_to_pdd_list</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">_axes</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="c1"># Adding default axes if not all are specified   </span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_axes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">default_axes</span><span class="p">)):</span>    
            <span class="c1"># Determining default axes for the ones which are not in _axes:</span>
            <span class="c1">#  either the ones in the plot or defaults</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">clear</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="c1"># Using the axis in the plot</span>
                <span class="n">plot_axes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">default_axes</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">_axes</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">_axes</span><span class="p">):</span><span class="nb">len</span><span class="p">(</span><span class="n">default_axes</span><span class="p">)]):</span>
                    <span class="c1"># If axis in plot has no name then using default axis else the plot axis</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                        <span class="n">plot_axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">d</span><span class="o">.</span><span class="n">data_unit</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                            <span class="n">plot_axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;__Data__&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">plot_axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">name</span>
                <span class="k">try</span><span class="p">:</span>            
                    <span class="n">pdd_def</span><span class="p">,</span><span class="n">plot_def_axes</span> <span class="o">=</span> <span class="n">axes_to_pdd_list</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">plot_axes</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">axname</span> <span class="ow">in</span> <span class="n">plot_axes</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">axname</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)):</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Plot coordinate &#39;&quot;</span><span class="o">+</span><span class="n">axname</span><span class="o">+</span><span class="s2">&quot;&#39; not found neither as coordinate nor data name. Must specifiy axes and use option={&#39;Force axes&#39;:True} to overplot.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If overplotting or no plot is available then using the default</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pdd_def</span><span class="p">,</span> <span class="n">plot_def_axes</span> <span class="o">=</span> <span class="n">axes_to_pdd_list</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">default_axes</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">_axes</span><span class="p">):])</span>   
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
            <span class="n">ax_list</span> <span class="o">+=</span> <span class="n">plot_def_axes</span>
            <span class="n">pdd_list</span> <span class="o">+=</span> <span class="n">pdd_def</span>
                     
                    
        <span class="n">ax_out_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Checking whether the units of this plot are consistent with the present axes                            </span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">clear</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">ax_in</span><span class="p">,</span><span class="n">ax_plot</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
                <span class="c1"># If none of the plot and the new axis has name and ot unit, the new axis will not have it either</span>
<span class="c1">#                if ((ax_plot.name == &#39;&#39;) or (ax_plot.unit == &#39;&#39;) or </span>
<span class="c1">#                    (ax_in.name == &#39;&#39;) or (ax_in.unit == &#39;&#39;)):</span>
<span class="c1">#                    ax_out_list.append(Unit())</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">ax_in</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">ax_plot</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ax_in</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">ax_plot</span><span class="o">.</span><span class="n">unit</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">force</span><span class="p">):</span>
                        <span class="n">u</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">Unit</span><span class="p">()</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">ax_in</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">ax_plot</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                            <span class="n">u</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">ax_in</span><span class="o">.</span><span class="n">name</span>
                        <span class="k">elif</span> <span class="p">((</span><span class="n">ax_in</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ax_in</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                            <span class="n">u</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">ax_plot</span><span class="o">.</span><span class="n">name</span> 
                        <span class="k">elif</span> <span class="p">((</span><span class="n">ax_plot</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ax_plot</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                            <span class="n">u</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">ax_in</span><span class="o">.</span><span class="n">name</span>    
                        <span class="k">if</span> <span class="p">(</span><span class="n">ax_in</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="n">ax_plot</span><span class="o">.</span><span class="n">unit</span><span class="p">):</span>
                            <span class="n">u</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">ax_in</span><span class="o">.</span><span class="n">unit</span>
                        <span class="k">elif</span> <span class="p">((</span><span class="n">ax_in</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ax_in</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                            <span class="n">u</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">ax_plot</span><span class="o">.</span><span class="n">unit</span> 
                        <span class="k">elif</span> <span class="p">((</span><span class="n">ax_plot</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ax_plot</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                            <span class="n">u</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">ax_in</span><span class="o">.</span><span class="n">unit</span>        
                        <span class="n">ax_out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Axis &#39;&quot;</span><span class="o">+</span><span class="n">ax_in</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;&#39; is incompatible with plot. Use option={&#39;Force axes&#39;:True}&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax_out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax_in</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_out_list</span> <span class="o">=</span> <span class="n">ax_list</span>
        <span class="k">return</span> <span class="n">pdd_list</span><span class="p">,</span> <span class="n">ax_out_list</span>
    
<div class="viewcode-block" id="set_plot_id"><a class="viewcode-back" href="../../plot.xhtml#flap.plot.set_plot_id">[docs]</a><span class="k">def</span> <span class="nf">set_plot_id</span><span class="p">(</span><span class="n">plot_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the current plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">act_plot_id</span><span class="p">,</span> <span class="n">gca_invalid</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">plot_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">plot_id</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">PlotID</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;flap.set_plot_id should receive a valid flap PlotID or None&quot;</span><span class="p">)</span>
    <span class="n">act_plot_id</span> <span class="o">=</span> <span class="n">plot_id</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">act_plot_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">gca_invalid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">gca_invalid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span> <span class="o">!=</span> <span class="n">plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">gca_invalid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gca_invalid</span> <span class="o">=</span> <span class="kc">False</span></div>
            
<div class="viewcode-block" id="get_plot_id"><a class="viewcode-back" href="../../plot.xhtml#flap.plot.get_plot_id">[docs]</a><span class="k">def</span> <span class="nf">get_plot_id</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the current PlotID or None if no act plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">act_plot_id</span><span class="p">,</span> <span class="n">gca_invalid</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">act_plot_id</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="n">gca_invalid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">None</span></div>
    
<span class="k">def</span> <span class="nf">__get_gca_invalid</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; This returns the global gca_invalid flag.</span>
<span class="sd">        This flag is set invalid when set_plot changes the default plot and this way</span>
<span class="sd">        the Matplotlib current axis (get_gca()) becomes invalid for this plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">gca_invalid</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="n">gca_invalid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">gca_invalid</span>
        
   
<div class="viewcode-block" id="sample_for_plot"><a class="viewcode-back" href="../../plot.xhtml#flap.plot.sample_for_plot">[docs]</a><span class="k">def</span> <span class="nf">sample_for_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">x_error</span><span class="p">,</span><span class="n">y_error</span><span class="p">,</span><span class="n">n_points</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resamples the y(x) function to np points for plotting.</span>
<span class="sd">    This is useful for plotting large arrays in a way that short outlier pulses</span>
<span class="sd">    are still indicated.</span>
<span class="sd">    The original function is divided into np equal size blocks in x and in each block</span>
<span class="sd">    the minimum and maximum is determined. The output will contain 2*np number</span>
<span class="sd">    or points. Each consecutive point pair contains the minimum and maximum in</span>
<span class="sd">    a block, the time is the centre time of the block.</span>

<span class="sd">    x: Input x array.</span>
<span class="sd">    y: input y array.</span>
<span class="sd">    np: Desired number of blocks. This would be a number larger than the number</span>
<span class="sd">        of pixels in the plot in the horizontal direction.</span>

<span class="sd">    Return values:</span>
<span class="sd">        x_out, y_out</span>
<span class="sd">        If the box length is less than 5 the original data will be returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">binlen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_points</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">binlen</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">x_error</span><span class="p">,</span><span class="n">y_error</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">binlen</span><span class="p">)</span>
    <span class="n">_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nx</span> <span class="o">*</span> <span class="n">binlen</span><span class="p">]</span>
    <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">_y</span><span class="p">,</span> <span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">binlen</span><span class="p">))</span>
    <span class="n">y_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="n">y_bin</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y_bin</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y_bin</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y_bin</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_bin</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">x_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">ind1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span> <span class="o">*</span> <span class="n">binlen</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">binlen</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">x_bin</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span>
    <span class="n">x_bin</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span>
    <span class="n">x_bin</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span>
    <span class="n">x_bin</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">x_error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y_error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="o">*</span> <span class="n">binlen</span> <span class="o">+</span> <span class="n">binlen</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x_error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x_error</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">x_error_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">x_bin</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">x_error</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">x_error_bin</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nx</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span> <span class="o">=</span> <span class="n">x_error</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_error_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="n">x_bin</span><span class="o">.</span><span class="n">size</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">x_error</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">x_error_bin</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nx</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span> <span class="o">=</span> <span class="n">x_error</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">x_error_bin</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nx</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span> <span class="o">=</span> <span class="n">x_error</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_error_bin</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">y_error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">y_error</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">y_error_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">y_bin</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">y_error</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">y_error_bin</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nx</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span> <span class="o">=</span> <span class="n">y_error</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_error_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="n">x_bin</span><span class="o">.</span><span class="n">size</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">y_error</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">y_error_bin</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nx</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span> <span class="o">=</span> <span class="n">y_error</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">y_error_bin</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nx</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span> <span class="o">=</span> <span class="n">y_error</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_error_bin</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">x_bin</span><span class="p">,</span> <span class="n">y_bin</span><span class="p">,</span> <span class="n">x_error_bin</span><span class="p">,</span> <span class="n">y_error_bin</span></div>

<span class="k">def</span> <span class="nf">_plot</span><span class="p">(</span><span class="n">data_object</span><span class="p">,</span> 
          <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">slicing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">summing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">slicing_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">plot_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">plot_options</span><span class="o">=</span><span class="p">{},</span>
          <span class="n">plot_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a data object.</span>
<span class="sd">    axes: A list of coordinate names (strings). They should be one of the coordinate</span>
<span class="sd">          names in the data object or &#39;Data&#39;</span>
<span class="sd">          They describe the axes of the plot.</span>
<span class="sd">          If the number of axes is less than the number required for the plot, &#39;__Data__&#39; will be added.</span>
<span class="sd">          If no axes are given default will be used depending on the plot type. E.g. for</span>
<span class="sd">          x-y plot the default first axis is the firs coordinate, the second axis is &#39;__Data__&#39;</span>
<span class="sd">    slicing, summing: arguments for slice_data. Slicing will be applied before plotting.</span>
<span class="sd">    slicing_options: options for slicing. See slice_data()</span>
<span class="sd">    plot_type: The plot type (string). Can be abbreviated.</span>
<span class="sd">          &#39;xy&#39;: Simple 1D plot. Default axes are: first coordinate, Data. For complex signals this</span>
<span class="sd">                produces two plots, see option &quot;Complex mode&#39;.</span>
<span class="sd">          &#39;multi xy&#39;: In case of 2D data plots 1D curves with vertical shift</span>
<span class="sd">                      Default x axis is first coordinate, y axis is Data</span>
<span class="sd">                      The signals are named in the label with the &#39;Signal name&#39; coordinate or the one</span>
<span class="sd">                      named in options[&#39;Signal name&#39;]</span>
<span class="sd">          &#39;image&#39;: Plots a 2D data matrix as an image. Options: Colormap, Data range, ...</span>
<span class="sd">          &#39;contour&#39;: Contour plot</span>
<span class="sd">    plot_options: Dictionary or list of dictionaries. Will be passed over to the plot call. For plots with multiple subplots this can be</span>
<span class="sd">                  a list of dictionaries, each for one subplot.</span>
<span class="sd">    plot_id: A PlotID object is the plot should go into an existing plot.</span>
<span class="sd">    options:</span>
<span class="sd">        &#39;Error&#39;      True: Plot all error bars (default: True)</span>
<span class="sd">                     False: Do not plot errors</span>
<span class="sd">                     number &gt; 0: Plot this many error bars in plot</span>
<span class="sd">        &#39;Y separation&#39; Vertical separation of curves in multi xy plot. For linear scale this will</span>
<span class="sd">                       be added to consecutive cureves. For Log scale consecutive curves will be</span>
<span class="sd">                       multiplied by this.</span>
<span class="sd">        &#39;Log x&#39; : Logscale X axis</span>
<span class="sd">        &#39;Log y&#39; : Logscale Y axis</span>
<span class="sd">        &#39;All points&#39; True or False</span>
<span class="sd">                     Default is False. If True will plot all points otherwise will plot only a reduced </span>
<span class="sd">                     number of points (see maxpoints). Each plotted point will be the mean of data</span>
<span class="sd">                     in a box and a vertical bar will indicate the value range in each box. </span>
<span class="sd">        &#39;Maxpoints&#39;: The maximum number of data points plotted. Above this only this many points will </span>
<span class="sd">                     be plotted if &quot;All points&quot; is False.</span>
<span class="sd">        &#39;Complex mode&#39;: &#39;Amp-phase&#39;: Plot amplitude and phase </span>
<span class="sd">                        &#39;Real-imag&#39;: Plot real and imaginary part</span>
<span class="sd">        &#39;X range&#39;,&#39;Y range&#39;: Axes ranges. (List of two numbers.)</span>
<span class="sd">        &#39;Z range&#39;: Range of the vertical axis. (List of two numbers.)</span>
<span class="sd">        &#39;Colormap&#39;: Cmap name for image and contour plots.</span>
<span class="sd">        &#39;Levels&#39;: Number of contour levels or array of levels.</span>
<span class="sd">        &#39;Aspect ratio&#39;: &#39;equal&#39;, &#39;auto&#39; or float. (See imshow)</span>
<span class="sd">        &#39;Waittime&#39; : Time to wait [Seconds] between two images in anim-... type plots</span>
<span class="sd">        &#39;Video file&#39;: Name of output video file for anim-... plots</span>
<span class="sd">        &#39;Video framerate&#39;:  Frame rate for output video.</span>
<span class="sd">        &#39;Video format&#39;: Format of the video. Valid: &#39;avi&#39;</span>
<span class="sd">        &#39;Clear&#39;: Boolean. If True don&#39;t use the existing plots, generate new. (No overplotting.)</span>
<span class="sd">        &#39;Force axes&#39;: Force overplotting even if axes are incpomatible</span>
<span class="sd">        &#39;Colorbar&#39;: Boolelan. Switch on/off colorbar</span>
<span class="sd">        &#39;Nan color&#39;: The color to use in image data plotting for np.nan (not-a-number) values</span>
<span class="sd">        &#39;Interpolation&#39;: Interpolation method for image plot.</span>
<span class="sd">        &#39;Language&#39;: Language of certain standard elements in the plot. (&#39;EN&#39;, &#39;HU&#39;)</span>
<span class="sd">        &#39;EFIT options&#39;: Dictionary of EFIT plotting options:</span>
<span class="sd">            &#39;Plot separatrix&#39;: Set to plot the separatrix onto the video</span>
<span class="sd">                &#39;Separatrix X&#39;: Name of the flap.DataObject for the separatrix X data (usually R)</span>
<span class="sd">                &#39;Separatrix Y&#39;: Name of the flap.DataObject for the separatrix Y data (usually z)</span>
<span class="sd">                &#39;Separatrix XY&#39;: Name of the 2D flap.DataObject for the separatrix XY data (usually Rz)</span>
<span class="sd">                &#39;Separatrix color&#39;: Color of the separatrix for the plot</span>
<span class="sd">            &#39;Plot limiter&#39;: Set to plot the limiter onto the video</span>
<span class="sd">                &#39;Limiter X&#39;: Name of the flap.DataObject for the limiter X data (usually R)</span>
<span class="sd">                &#39;Limiter Y&#39;: Name of the flap.DataObject for the limiter Y data (usually z)</span>
<span class="sd">                &#39;Limiter XY&#39;: Name of the 2D flap.DataObject for the limiter XY data (usually Rz)</span>
<span class="sd">                &#39;Limiter color&#39;: Color of the limiter for the plot</span>
<span class="sd">            &#39;Plot flux surfaces&#39;: Name of the 2D flap.DataObject for the flux surfaces</span>
<span class="sd">                (should have the same coordinate names as the plot)</span>
<span class="sd">                &#39;nlevels&#39;: Number of contour lines for the flux surface plotting</span>
<span class="sd">        &#39;Prevent saturation&#39;: Prevents saturation of the video signal when it exceeds zrange[1]</span>
<span class="sd">            It uses data modulo zrange[1] to overcome the saturation. (works for animation)</span>
<span class="sd">            </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;All points&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Y separation&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="s1">&#39;Log x&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;Log y&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;Log z&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;maxpoints&#39;</span><span class="p">:</span><span class="mi">4000</span><span class="p">,</span> <span class="s1">&#39;Complex mode&#39;</span><span class="p">:</span><span class="s1">&#39;Amp-phase&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;X range&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Y range&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Z range&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span><span class="s1">&#39;Aspect ratio&#39;</span><span class="p">:</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Clear&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;Force axes&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;Language&#39;</span><span class="p">:</span><span class="s1">&#39;EN&#39;</span><span class="p">,</span><span class="s1">&#39;Maxpoints&#39;</span><span class="p">:</span> <span class="mi">4000</span><span class="p">,</span>
                       <span class="s1">&#39;Levels&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;Colormap&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Waittime&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Colorbar&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;Nan color&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                       <span class="s1">&#39;Interpolation&#39;</span><span class="p">:</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span><span class="s1">&#39;Video file&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Video framerate&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span><span class="s1">&#39;Video format&#39;</span><span class="p">:</span><span class="s1">&#39;avi&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;EFIT options&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Prevent saturation&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;Plot units&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
                       <span class="p">}</span>
    <span class="n">_options</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">merge_options</span><span class="p">(</span><span class="n">default_options</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">data_source</span><span class="o">=</span><span class="n">data_object</span><span class="o">.</span><span class="n">data_source</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">plot_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">_plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_plot_options</span> <span class="o">=</span> <span class="n">plot_options</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_plot_options</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">_plot_options</span> <span class="o">=</span> <span class="p">[</span><span class="n">_plot_options</span><span class="p">]</span>


    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Clear&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid type for option Clear. Should be boolean.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Force axes&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid type for option &#39;Force axes&#39;. Should be boolean.&quot;</span><span class="p">)</span>    
    
    <span class="k">if</span> <span class="p">((</span><span class="n">slicing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">summing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">data_object</span><span class="o">.</span><span class="n">slice_data</span><span class="p">(</span><span class="n">slicing</span><span class="o">=</span><span class="n">slicing</span><span class="p">,</span> <span class="n">summing</span><span class="o">=</span><span class="n">summing</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">slicing_options</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">data_object</span>        
        
    <span class="c1"># Determining a PlotID:</span>
    <span class="c1"># argument, actual or a new one</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">plot_id</span><span class="p">)</span> <span class="ow">is</span> <span class="n">PlotID</span><span class="p">):</span>
        <span class="n">_plot_id</span> <span class="o">=</span> <span class="n">plot_id</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_plot_id</span> <span class="o">=</span> <span class="n">get_plot_id</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_plot_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span> 
            <span class="c1"># If there is no actual plot we create a new one </span>
            <span class="n">_plot_id</span> <span class="o">=</span> <span class="n">PlotID</span><span class="p">()</span>
            <span class="n">_plot_id</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">number</span>
            <span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>    
            <span class="k">if</span> <span class="p">((</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">figure</span> <span class="o">!=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">number</span><span class="p">)):</span>
                <span class="c1"># If the actual subplot is not the one in the plot ID then either the subplot was</span>
                <span class="c1"># changed to a new one or the plot_ID changed with set_plot. </span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">__get_gca_invalid</span><span class="p">()):</span>
                    <span class="c1"># This means the plot ID was not changed, the actual plot or axis was changed.</span>
                    <span class="c1"># Therefore we need to use the actual values         </span>
                    <span class="n">_plot_id</span> <span class="o">=</span> <span class="n">PlotID</span><span class="p">()</span>
                    <span class="n">_plot_id</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">number</span>
                    <span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>  
                    <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Clear&#39;</span><span class="p">]</span> <span class="p">):</span>
        <span class="n">_plot_id</span> <span class="o">=</span> <span class="n">PlotID</span><span class="p">()</span>
<span class="c1">#        _plot_id.clear()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">figure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_plot_id</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">number</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>          
        <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
            
    <span class="c1"># Setting plot type</span>
    <span class="n">known_plot_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span><span class="s1">&#39;multi xy&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;anim-image&#39;</span><span class="p">,</span><span class="s1">&#39;contour&#39;</span><span class="p">,</span><span class="s1">&#39;anim-contour&#39;</span><span class="p">,</span><span class="s1">&#39;animation&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plot_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">_plot_type</span> <span class="o">=</span> <span class="s1">&#39;xy&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">_plot_type</span> <span class="o">=</span> <span class="s1">&#39;multi xy&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">_plot_type</span> <span class="o">=</span> <span class="s1">&#39;anim-image&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No default plot type for this kind of data, set plot_type.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_plot_type</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">find_str_match</span><span class="p">(</span><span class="n">plot_type</span><span class="p">,</span><span class="n">known_plot_types</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid type for plot_type. String is expected.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown plot type or too short abbreviation&quot;</span><span class="p">)</span>    

    <span class="c1"># Processing some options</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;multi xy&#39;</span><span class="p">)):</span>
        <span class="n">all_points</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;All points&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">all_points</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Option &#39;All points&#39; should be boolean.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_points</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">plot_error</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">plot_error</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">plot_error</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid number of error bars in plot (option: Error).&quot;</span><span class="p">)</span>
            <span class="n">errorbars</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">plot_error</span><span class="p">)</span>
            <span class="n">plot_error</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;Error&#39; option.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">errorbars</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="c1"># The maximum number of points expected in the horizontal dimension of a plot</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">maxpoints</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Maxpoints&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid maxpoints setting.&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">compt</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">find_str_match</span><span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Complex mode&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Amp-phase&#39;</span><span class="p">,</span><span class="s1">&#39;Real-imag&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;Complex mode&#39; option:&quot;</span> <span class="o">+</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Complex mode&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">compt</span> <span class="o">==</span> <span class="s1">&#39;Amp-phase&#39;</span><span class="p">):</span>
        <span class="n">comptype</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">compt</span> <span class="o">==</span> <span class="s1">&#39;Real-imag&#39;</span><span class="p">):</span>    
        <span class="n">comptype</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">number_of_plots</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Complex mode&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Complex mode&#39;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Different complex plot mode in overplot.&quot;</span><span class="p">)</span>

    <span class="n">language</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Language&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Video file&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Video format&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;avi&#39;</span><span class="p">):</span>
            <span class="n">video_codec_code</span> <span class="o">=</span> <span class="s1">&#39;XVID&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot write video in format &#39;&quot;</span><span class="o">+</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Video format&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;&#39;.&quot;</span><span class="p">)</span>
        
       
    <span class="c1"># X range and Z range is processed here, but Y range not as it might have multiple entries for some plots</span>
    <span class="n">xrange</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;X range&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">xrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xrange</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid X range setting.&quot;</span><span class="p">)</span>
    <span class="n">zrange</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Z range&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">zrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">zrange</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zrange</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Z range setting.&quot;</span><span class="p">)</span>
     
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Colormap&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">cmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Colormap should be a string.&quot;</span><span class="p">)</span>
    
    <span class="n">contour_levels</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Levels&#39;</span><span class="p">]</span>    
    <span class="c1"># Here _plot_id is a valid (maybe empty) PlotID</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;scatter&#39;</span><span class="p">)):</span>
        <span class="c1"># 1D plots: xy, scatter and complex versions</span>
        <span class="c1"># Checking whether oveplotting into the same plot type</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">d</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">)):</span> 
            <span class="n">subtype</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subtype</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Clear&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">plot_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">!=</span> <span class="s1">&#39;xy&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">!=</span> <span class="s1">&#39;scatter&#39;</span><span class="p">))</span> 
                <span class="ow">or</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">plot_subtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">plot_subtype</span> <span class="o">!=</span> <span class="n">subtype</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Overplotting into different plot type. Use option={&#39;Clear&#39;:True} to erase first.&quot;</span><span class="p">)</span>
        <span class="c1"># Processing axes</span>
        <span class="n">default_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;__Data__&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdd_list</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">check_axes</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> 
                                                    <span class="n">axes</span><span class="p">,</span> 
                                                    <span class="n">clear</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Clear&#39;</span><span class="p">],</span> 
                                                    <span class="n">default_axes</span><span class="o">=</span><span class="n">default_axes</span><span class="p">,</span> 
                                                    <span class="n">force</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Force axes&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="c1"># Preparing data    </span>
        <span class="n">plotdata</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
        <span class="n">plotdata_low</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>                                                    <span class="c1">#UNUSED</span>
        <span class="n">plotdata_high</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>                                                   <span class="c1">#UNUSED</span>
        <span class="n">ploterror</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
        <span class="k">for</span> <span class="n">ax_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Data</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;xy plot is applicable only to 1D data. Use slicing.&quot;</span><span class="p">)</span>
                <span class="n">plotdata</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">plot_error</span><span class="p">):</span>
                    <span class="n">ploterror</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">_plot_error_ranges</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ploterror</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Coordinate is not of numeric type, cannot plot.&quot;</span><span class="p">)</span>
                <span class="n">pdata</span><span class="p">,</span> <span class="n">pdata_low</span><span class="p">,</span> <span class="n">pdata_high</span> <span class="o">=</span> \
                                    <span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">plotdata</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">pdata_low</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">pdata_low</span> <span class="o">=</span> <span class="n">pdata_low</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">pdata_high</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">pdata_high</span> <span class="o">=</span> <span class="n">pdata_high</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">plot_error</span><span class="p">):</span>
                    <span class="n">ploterror</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span>  <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">_plot_coord_ranges</span><span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                                                         <span class="n">pdata</span><span class="p">,</span> 
                                                                                         <span class="n">pdata_low</span><span class="p">,</span> 
                                                                                         <span class="n">pdata_high</span>
                                                                                         <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ploterror</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                <span class="n">plotdata</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="n">ploterror</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Internal error, invalid PlotDataDescription.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">number_of_plots</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Log x&#39;</span><span class="p">]</span>
            <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Log y&#39;</span><span class="p">]</span>
            

        <span class="n">xdata</span> <span class="o">=</span> <span class="n">plotdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xerror</span> <span class="o">=</span> <span class="n">ploterror</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">subtype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>     
            <span class="n">yrange</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Y range&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Y range setting.&quot;</span><span class="p">)</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span>
            <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
    
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">plotdata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">yerror</span> <span class="o">=</span> <span class="n">ploterror</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># Checking for constants, converting to numpy array</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">ydata</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">xdata</span><span class="p">)):</span>
                    <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">xdata</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>
                <span class="n">yerror</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">xdata</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">ydata</span><span class="p">)):</span>
                    <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">xdata</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ydata</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">xdata</span><span class="p">)</span>
                <span class="n">xerror</span> <span class="o">=</span> <span class="kc">None</span>
    
            <span class="k">if</span> <span class="p">(</span><span class="n">all_points</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">xdata</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">ydata</span>
                <span class="n">xerr</span> <span class="o">=</span> <span class="n">xerror</span>
                <span class="n">yerr</span> <span class="o">=</span> <span class="n">yerror</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xerr</span><span class="p">,</span><span class="n">yerr</span> <span class="o">=</span> <span class="n">sample_for_plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="n">xerror</span><span class="p">,</span><span class="n">yerror</span><span class="p">,</span><span class="n">maxpoints</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">errorbars</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">errorevery</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errorevery</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">errorbars</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">errorevery</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">errorevery</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">_plot_opt</span> <span class="o">=</span> <span class="n">_plot_options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_plot_opt</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Plot options should be a dictionary or list of dictionaries.&quot;</span><span class="p">)</span>
   
            <span class="k">if</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">):</span>                
                <span class="k">if</span> <span class="p">(</span><span class="n">plot_error</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xerr</span><span class="o">=</span><span class="n">xerr</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span><span class="n">errorevery</span><span class="o">=</span><span class="n">errorevery</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">plot_error</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xerr</span><span class="o">=</span><span class="n">xerr</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span><span class="n">errorevery</span><span class="o">=</span><span class="n">errorevery</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
                    
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log x&#39;</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log y&#39;</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">xrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
            <span class="n">title</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_title</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">title</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">!=</span> <span class="s1">&#39;...&#39;</span><span class="p">):</span>
                <span class="n">newtitle</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">newtitle</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">newtitle</span> <span class="o">+=</span> <span class="n">d</span><span class="o">.</span><span class="n">data_title</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newtitle</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span> <span class="o">+</span> <span class="n">newtitle</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">title</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="n">newtitle</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">title</span> <span class="o">=</span> <span class="n">newtitle</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;,...&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

            <span class="n">_plot_id</span><span class="o">.</span><span class="n">plot_subtype</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># real xy plot </span>
            <span class="c1"># End of real xy and scatter plot</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Complex xy plot</span>
            <span class="n">yrange</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Y range&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Y range setting.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)):</span>
                        <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">yrange</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Y range setting. For complex xy plot either a list or list of two lists can be used.&quot;</span><span class="p">)</span>
                    <span class="n">yrange</span> <span class="o">=</span> <span class="p">[</span><span class="n">yrange</span><span class="p">,</span><span class="n">yrange</span><span class="p">]</span>

            <span class="c1"># Complex xy and scatter plot</span>
            <span class="c1"># Creating two sublots if this is a new plot</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">number_of_plots</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">subplot_spec</span><span class="o">=</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span><span class="p">)</span>
                <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="c1"># Taking the mean of the complex errors</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ploterror</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ploterror</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">yerror_abs</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ploterror</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ploterror</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>  <span class="o">/</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">yerror_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ploterror</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yerror_abs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">i_comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>            
                <span class="n">ax</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span><span class="p">[</span><span class="n">i_comp</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">comptype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="c1"># amp-phase</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">i_comp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">plotdata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">yerror</span> <span class="o">=</span> <span class="n">yerror_abs</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ydata_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">plotdata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">plotdata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">yerror_abs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                            <span class="n">yerror</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">ydata</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">ydata_abs</span> <span class="o">&lt;=</span> <span class="n">yerror_abs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">yerror</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
                            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">ydata_abs</span> <span class="o">&gt;</span> <span class="n">yerror_abs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">yerror</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">yerror_abs</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span><span class="n">ydata_abs</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">yerror</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># real-imag</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">i_comp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">plotdata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">yerror</span> <span class="o">=</span> <span class="n">yerror_abs</span>
                    <span class="k">else</span><span class="p">:</span>    
                        <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">plotdata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">yerror</span> <span class="o">=</span> <span class="n">yerror_abs</span>

                <span class="c1"># Checking for constants, converting to numpy array</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">ydata</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">xdata</span><span class="p">)):</span>
                        <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">xdata</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">plot_error</span><span class="p">):</span>
                        <span class="n">yerror</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">_plot_coord_ranges</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">ydata_low</span><span class="p">,</span> <span class="n">ydata_high</span><span class="p">)</span> <span class="c1">#THESE ARE UNDEFINED</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">yerror</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">xdata</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">ydata</span><span class="p">)):</span>
                        <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">xdata</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ydata</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">xdata</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">plot_error</span><span class="p">):</span>
                        <span class="n">xerror</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">_plot_coord_ranges</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">xdata_low</span><span class="p">,</span> <span class="n">xdata_high</span><span class="p">)</span> <span class="c1">#THESE ARE UNDEFINED</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">xerror</span> <span class="o">=</span> <span class="kc">None</span>
        
                <span class="k">if</span> <span class="p">(</span><span class="n">all_points</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">xdata</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">ydata</span>
                    <span class="n">xerr</span> <span class="o">=</span> <span class="n">xerror</span>
                    <span class="n">yerr</span> <span class="o">=</span> <span class="n">yerror</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xerr</span><span class="p">,</span><span class="n">yerr</span> <span class="o">=</span> <span class="n">sample_for_plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="n">xerror</span><span class="p">,</span><span class="n">yerror</span><span class="p">,</span><span class="n">maxpoints</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">errorbars</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">errorevery</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">errorevery</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">errorbars</span><span class="p">))</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">errorevery</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">errorevery</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="n">_plot_opt</span> <span class="o">=</span> <span class="n">_plot_options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_plot_opt</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">_plot_opt</span><span class="p">[</span><span class="n">i_comp</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_plot_opt</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Plot options should be a dictionary or list of dictionaries.&quot;</span><span class="p">)</span>
       
                <span class="k">if</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">):</span>                
                    <span class="k">if</span> <span class="p">(</span><span class="n">plot_error</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xerr</span><span class="o">=</span><span class="n">xerr</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span><span class="n">errorevery</span><span class="o">=</span><span class="n">errorevery</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">plot_error</span><span class="p">):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xerr</span><span class="o">=</span><span class="n">xerr</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span><span class="n">errorevery</span><span class="o">=</span><span class="n">errorevery</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>

                <span class="c1"># Setting axis labels</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">,</span><span class="n">complex_txt</span><span class="o">=</span><span class="p">[</span><span class="n">comptype</span><span class="p">,</span><span class="n">i_comp</span><span class="p">]))</span> 
    
                <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log x&#39;</span><span class="p">]):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log y&#39;</span><span class="p">]):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">xrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">[</span><span class="n">i_comp</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">yrange</span><span class="p">[</span><span class="n">i_comp</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_title</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">title</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">!=</span> <span class="s1">&#39;...&#39;</span><span class="p">):</span>
                <span class="n">newtitle</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">newtitle</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">newtitle</span> <span class="o">+=</span> <span class="n">d</span><span class="o">.</span><span class="n">data_title</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newtitle</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span> <span class="o">+</span> <span class="n">newtitle</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">title</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="n">newtitle</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">title</span> <span class="o">=</span> <span class="n">newtitle</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;,...&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

            <span class="n">_plot_id</span><span class="o">.</span><span class="n">plot_subtype</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1"># End of complex xy and scatter plot</span>
        
    <span class="k">elif</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;multi xy&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;multi x-y plot is applicable to 2D data only. Use slicing.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;multi x-y plot is applicable to 2D data only.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;multi x-y plot is applicable only to real data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For multi xy plot only one axis can be given.&quot;</span><span class="p">)</span>

        <span class="n">yrange</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Y range&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Y range setting.&quot;</span><span class="p">)</span>

        <span class="c1"># Processing axes</span>
        <span class="n">default_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;__Data__&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdd_list</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">check_axes</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> 
                                                    <span class="n">axes</span><span class="p">,</span> 
                                                    <span class="n">clear</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Clear&#39;</span><span class="p">],</span> 
                                                    <span class="n">default_axes</span><span class="o">=</span><span class="n">default_axes</span><span class="p">,</span> 
                                                    <span class="n">force</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Force axes&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">):</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Plotting coordinate for multi xy plot should change only along 1 dimension.&quot;</span><span class="p">)</span>
        <span class="n">axis_index</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">((</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Data</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span> <span class="o">==</span> <span class="n">d</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For multi xy plot only data can be plotted on the y axis.&quot;</span><span class="p">)</span>
            
        <span class="c1"># Trying to get signal names</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">signals_coord</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_coordinate_object</span><span class="p">(</span><span class="s1">&#39;Signal name&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">signals_coord</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span><span class="p">((</span><span class="n">signals_coord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signals_coord</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>\
           <span class="ow">and</span> <span class="p">(</span><span class="n">signals_coord</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">axis_index</span><span class="p">)):</span>
               <span class="k">if</span> <span class="p">(</span><span class="n">axis_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                   <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">...</span><span class="p">]</span>
               <span class="k">else</span><span class="p">:</span>
                   <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
               <span class="n">signal_names</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">signals_coord</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
               <span class="n">signal_names</span> <span class="o">=</span> <span class="n">signal_names</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signal_names</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Getting x data    </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Data</span><span class="p">):</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plot_error</span><span class="p">):</span>
                <span class="n">xerror</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">_plot_error_ranges</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xerror</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Coordinate is not of numeric type, cannot plot.&quot;</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
            <span class="n">index</span><span class="p">[</span><span class="n">axis_index</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
            <span class="n">xdata</span><span class="p">,</span> <span class="n">xdata_low</span><span class="p">,</span> <span class="n">xdata_high</span> <span class="o">=</span> \
                                <span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">xdata</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">xdata_low</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">xdata_low</span>  <span class="o">=</span> <span class="n">xdata_low</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">xdata_high</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">xdata_high</span> <span class="o">=</span> <span class="n">xdata_high</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plot_error</span><span class="p">):</span>
                <span class="n">xerror</span>  <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">_plot_coord_ranges</span><span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                                     <span class="n">xdata</span><span class="p">,</span> 
                                                                     <span class="n">xdata_low</span><span class="p">,</span> 
                                                                     <span class="n">xdata_high</span>
                                                                     <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xerror</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="n">ax_ind</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">xerror</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Internal error, invalid PlotDataDescription.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">number_of_plots</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Log x&#39;</span><span class="p">]</span>
            <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Log y&#39;</span><span class="p">]</span>
            
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span>
        <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
        
        <span class="n">ysep</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Y separation&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ysep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">number_of_plots</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">ysep</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Y separation&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log y&#39;</span><span class="p">]):</span>
                    <span class="n">maxval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">minval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">minval</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">minval</span> <span class="o">==</span> <span class="n">maxval</span><span class="p">)):</span>
                        <span class="n">ysep</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ysep</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">maxval</span><span class="o">/</span><span class="n">minval</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ysep</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ysep</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ysep</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Y separation option.&quot;</span><span class="p">)</span> 
        <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Y separation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ysep</span>
                
        <span class="c1"># Determining Y range</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">axis_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log y&#39;</span><span class="p">]):</span>
                <span class="n">ax_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ax_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">ysep</span> <span class="o">**</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ax_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">ysep</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">signal_index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log y&#39;</span><span class="p">]):</span>
                <span class="n">ax_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
                <span class="n">ax_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span> <span class="o">*</span> <span class="n">ysep</span> <span class="o">**</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
                <span class="n">ax_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span> <span class="o">+</span> <span class="n">ysep</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">signal_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># If overplot then taking min and max of this and previous plots    </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">number_of_plots</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">ax_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax_min</span><span class="p">)</span>
            <span class="n">ax_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ax_max</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ax_max</span> <span class="o">&lt;=</span> <span class="n">ax_min</span><span class="p">):</span>
            <span class="n">ax_max</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax_min</span><span class="p">,</span> <span class="n">ax_max</span><span class="p">)</span>

        <span class="n">legend</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">signal_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">signal_index</span><span class="p">]):</span>
                <span class="n">legend</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signal_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend</span><span class="p">)</span>
         
        <span class="n">_plot_opt</span> <span class="o">=</span> <span class="n">_plot_options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">signal_index</span><span class="p">]):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">index</span><span class="p">[</span><span class="n">signal_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">yerror</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">_plot_error_ranges</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log y&#39;</span><span class="p">]):</span>
                <span class="n">ydata</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">ysep</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">yerror</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">yerror</span> <span class="o">*=</span> <span class="p">(</span><span class="n">ysep</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ydata</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">+</span> <span class="n">ysep</span> <span class="o">*</span> <span class="n">i</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">all_points</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">xdata</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">ydata</span>
                <span class="n">xerr</span> <span class="o">=</span> <span class="n">xerror</span>
                <span class="n">yerr</span> <span class="o">=</span> <span class="n">yerror</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xerr</span><span class="p">,</span><span class="n">yerr</span> <span class="o">=</span> <span class="n">sample_for_plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="n">xerror</span><span class="p">,</span><span class="n">yerror</span><span class="p">,</span><span class="n">maxpoints</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">errorbars</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">errorevery</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errorevery</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">errorbars</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">errorevery</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">errorevery</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plot_error</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xerr</span><span class="o">=</span><span class="n">xerr</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span><span class="n">errorevery</span><span class="o">=</span><span class="n">errorevery</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">xrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log x&#39;</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log y&#39;</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_title</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">title</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">!=</span> <span class="s1">&#39;...&#39;</span><span class="p">):</span>
            <span class="n">newtitle</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">newtitle</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">newtitle</span> <span class="o">+=</span> <span class="n">d</span><span class="o">.</span><span class="n">data_title</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newtitle</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span> <span class="o">+</span> <span class="n">newtitle</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">title</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                        <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="n">newtitle</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="n">newtitle</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;,...&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>        
        <span class="n">_plot_id</span><span class="o">.</span><span class="n">plot_subtype</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># real multi xy plot </span>

    <span class="k">elif</span> <span class="p">((</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;image&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;contour&#39;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot plot DataObject without data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Image/contour plot is applicable to 2D data only. Use slicing.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Image/contour plot is applicable only to real data.&quot;</span><span class="p">)</span>
        <span class="c1"># Checking for numeric type</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Image plot is applicable only to numeric data.&quot;</span><span class="p">)</span>
        
        <span class="n">yrange</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Y range&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Y range setting.&quot;</span><span class="p">)</span>

        <span class="c1"># Processing axes</span>
        <span class="c1"># Although the plot will be cleared the existing plot axes will be considered</span>
        <span class="n">default_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;__Data__&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdd_list</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">check_axes</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> 
                                                    <span class="n">axes</span><span class="p">,</span> 
                                                    <span class="n">clear</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Clear&#39;</span><span class="p">],</span> 
                                                    <span class="n">default_axes</span><span class="o">=</span><span class="n">default_axes</span><span class="p">,</span> 
                                                    <span class="n">force</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Force axes&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="c1"># No overplotting is possible for this type of plot, erasing and restarting a Plot_ID</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Clear&#39;</span><span class="p">]):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">subplot_spec</span><span class="o">=</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span><span class="p">)</span>
        <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">pdd_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Data</span>
        <span class="n">pdd_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span> <span class="o">=</span> <span class="n">d</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">!=</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">!=</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;X and y coordinates of image plot type should be coordinates.&quot;</span><span class="p">)</span>

        <span class="n">coord_x</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">coord_y</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;image&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">coord_x</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">coord_y</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="c1"># This data is image-like with data points on a rectangular array</span>
                <span class="n">image_like</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">coord_x</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Coordinate &#39;</span><span class="o">+</span><span class="n">coord_x</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39; is not numeric.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Coordinate &#39;</span><span class="o">+</span><span class="n">coord_y</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39; is not numeric.&#39;</span><span class="p">)</span>
                <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">index</span><span class="p">[</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span>
                <span class="n">xdata</span><span class="p">,</span><span class="n">xdata_low</span><span class="p">,</span><span class="n">xdata_high</span> <span class="o">=</span> <span class="n">coord_x</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                <span class="n">xdata</span> <span class="o">=</span> <span class="n">xdata</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">xdata</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">xdata</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">index</span><span class="p">[</span><span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span>
                <span class="n">ydata</span><span class="p">,</span><span class="n">ydata_low</span><span class="p">,</span><span class="n">ydata_high</span> <span class="o">=</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                <span class="n">ydata</span> <span class="o">=</span> <span class="n">ydata</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">ydata</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">dx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="n">dy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">dy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
                    <span class="c1"># Actually the non-equidistant coordinates are equidistant</span>
                    <span class="n">image_like</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">image_like</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">image_like</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image_like</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">image_like</span><span class="p">):</span>        
            <span class="n">xdata_range</span> <span class="o">=</span> <span class="n">coord_x</span><span class="o">.</span><span class="n">data_range</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>   
            <span class="n">ydata_range</span> <span class="o">=</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">data_range</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>   
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ydata</span><span class="p">,</span><span class="n">ydata_low</span><span class="p">,</span><span class="n">ydata_high</span> <span class="o">=</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">xdata</span><span class="p">,</span><span class="n">xdata_low</span><span class="p">,</span><span class="n">xdata_high</span> <span class="o">=</span> <span class="n">coord_x</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">zrange</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">zrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">zrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">vmax</span> <span class="o">&lt;=</span> <span class="n">vmin</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid z range.&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log z&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">vmin</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;z range[0] cannot be negative or zero for logarithmic scale.&quot;</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
            <span class="n">locator</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">subs</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">locator</span> <span class="o">=</span> <span class="kc">None</span>
                
        <span class="k">if</span> <span class="p">(</span><span class="n">contour_levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">contour_levels</span> <span class="o">=</span> <span class="mi">255</span>
            
        <span class="n">_plot_opt</span> <span class="o">=</span> <span class="n">_plot_options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmap_obj</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Nan color&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">cmap_obj</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Nan color&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid color map.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">image_like</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span> 
<span class="c1">#                if (coord_x.dimension_list[0] == 0):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">im</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">im</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">)</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">xdata_range</span> <span class="o">+</span> <span class="n">ydata_range</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_obj</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Aspect ratio&#39;</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Interpolation&#39;</span><span class="p">],</span>
                                <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">im</span>                    
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;image&#39;</span><span class="p">):</span>
                <span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_to_box</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span><span class="n">ygrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">),</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
                                        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">),</span><span class="n">contour_levels</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                                      <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
                
        <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Colorbar&#39;</span><span class="p">]):</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data_unit</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data_unit</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="n">unit_name</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span><span class="o">+</span><span class="n">d</span><span class="o">.</span><span class="n">data_unit</span><span class="o">.</span><span class="n">unit</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unit_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data_unit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">unit_name</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">xrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log x&#39;</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log y&#39;</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_title</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">title</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">!=</span> <span class="s1">&#39;...&#39;</span><span class="p">):</span>
            <span class="n">newtitle</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">newtitle</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">newtitle</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">d</span><span class="o">.</span><span class="n">data_title</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newtitle</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span> <span class="o">+</span> <span class="n">newtitle</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">title</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                        <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="n">newtitle</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="n">newtitle</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;,...&#39;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>   
                
    <span class="k">elif</span> <span class="p">((</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;anim-image&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;anim-contour&#39;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot plot DataObject without data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Animated image plot is applicable to 3D data only. Use slicing.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Animated image plot is applicable only to real data.&quot;</span><span class="p">)</span>
        <span class="c1"># Checking for numeric type</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Animated image plot is applicable only to numeric data.&quot;</span><span class="p">)</span>
        
        <span class="n">yrange</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Y range&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Y range setting.&quot;</span><span class="p">)</span>

        <span class="c1"># Processing axes</span>
        <span class="c1"># Although the plot will be cleared the existing plot axes will be considered</span>
        <span class="n">default_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;__Data__&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdd_list</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">check_axes</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> 
                                                    <span class="n">axes</span><span class="p">,</span> 
                                                    <span class="n">clear</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Clear&#39;</span><span class="p">],</span> 
                                                    <span class="n">default_axes</span><span class="o">=</span><span class="n">default_axes</span><span class="p">,</span> 
                                                    <span class="n">force</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Force axes&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">((</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Data</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span> <span class="o">==</span> <span class="n">d</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For anim-image/anim-contour plot only data can be plotted on the z axis.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">!=</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">!=</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;X and y coordinates of anim-image/anim-contour plot type should be coordinates.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">!=</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time coordinate of anim-image/anim-contour plot should be flap.coordinate.&quot;</span><span class="p">)</span>

        <span class="n">coord_x</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">coord_y</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">coord_t</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_t</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time coordinate for anim-image/anim-contour plot should be changing only along one dimension.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coord_t</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">badx</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">badx</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coord_t</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">bady</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">bady</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">badx</span> <span class="ow">or</span> <span class="n">bady</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;X and y coordinate for anim-image plot should not change in time dimension.&quot;</span><span class="p">)</span>
            
        <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
        <span class="n">index</span><span class="p">[</span><span class="n">coord_t</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span>
        <span class="n">tdata</span> <span class="o">=</span> <span class="n">coord_t</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Coordinate &#39;</span><span class="o">+</span><span class="n">coord_y</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39; is not numeric.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">coord_x</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">coord_y</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="c1"># This data is image-like with data points on a rectangular array</span>
            <span class="n">image_like</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">coord_x</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Coordinate &#39;</span><span class="o">+</span><span class="n">coord_x</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39; is not numeric.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Coordinate &#39;</span><span class="o">+</span><span class="n">coord_y</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39; is not numeric.&#39;</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">index</span><span class="p">[</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span>
            <span class="n">xdata</span><span class="p">,</span><span class="n">xdata_low</span><span class="p">,</span><span class="n">xdata_high</span> <span class="o">=</span> <span class="n">coord_x</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">xdata</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">xdata</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">xdata</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">index</span><span class="p">[</span><span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span>
            <span class="n">ydata</span><span class="p">,</span><span class="n">ydata_low</span><span class="p">,</span><span class="n">ydata_high</span> <span class="o">=</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">ydata</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">ydata</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">dx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="n">dy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">dy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="c1"># Actually the non-equidistant coordinates are equidistant</span>
                <span class="n">image_like</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">image_like</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image_like</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">image_like</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;anim-image&#39;</span><span class="p">)):</span>        
            <span class="n">xdata_range</span> <span class="o">=</span> <span class="n">coord_x</span><span class="o">.</span><span class="n">data_range</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>   
            <span class="n">ydata_range</span> <span class="o">=</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">data_range</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>   
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span>
            <span class="n">index</span><span class="p">[</span><span class="n">coord_t</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coord_y</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coord_x</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmap_obj</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Nan color&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">cmap_obj</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Nan color&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid color map.&quot;</span><span class="p">)</span>

        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">subplot_spec</span><span class="o">=</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span><span class="p">)</span>
<span class="c1">#        ax=plt.plot()</span>
        <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
<span class="c1">#        plt.subplot(_plot_id.base_subplot)</span>
<span class="c1">#        plt.plot()</span>
<span class="c1">#        plt.cla()</span>
<span class="c1">#        ax=plt.gca()</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tdata</span><span class="p">)):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span><span class="p">)</span>
            <span class="n">ax_act</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">time_index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>
            <span class="n">time_index</span><span class="p">[</span><span class="n">coord_t</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">it</span>
            <span class="n">time_index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">time_index</span><span class="p">)</span>
    
            <span class="k">if</span> <span class="p">(</span><span class="n">zrange</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_index</span><span class="p">])</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_index</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="n">zrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">zrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
            <span class="k">if</span> <span class="p">(</span><span class="n">vmax</span> <span class="o">&lt;=</span> <span class="n">vmin</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid z range.&quot;</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log z&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">vmin</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;z range[0] cannot be negative or zero for logarithmic scale.&quot;</span><span class="p">)</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                <span class="n">locator</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">subs</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">locator</span> <span class="o">=</span> <span class="kc">None</span>                                                  <span class="c1">#UNUSED</span>
                    
            <span class="k">if</span> <span class="p">(</span><span class="n">contour_levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">contour_levels</span> <span class="o">=</span> <span class="mi">255</span>
                
            <span class="n">_plot_opt</span> <span class="o">=</span> <span class="n">_plot_options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
            <span class="k">if</span> <span class="p">(</span><span class="n">image_like</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;anim-image&#39;</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1">#if (coord_x.dimension_list[0] == 0):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_index</span><span class="p">]),</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_index</span><span class="p">],</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">)</span>
                        
                    <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">xdata_range</span> <span class="o">+</span> <span class="n">ydata_range</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                                     <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_obj</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
                                     <span class="n">aspect</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Aspect ratio&#39;</span><span class="p">],</span>
                                     <span class="n">interpolation</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Interpolation&#39;</span><span class="p">],</span>
                                     <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>            
                    <span class="k">del</span> <span class="n">im</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;anim-image&#39;</span><span class="p">):</span>
                    <span class="n">xgrid</span><span class="p">,</span> <span class="n">ygrid</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_to_box</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">)</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_index</span><span class="p">]),</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span><span class="n">ygrid</span><span class="p">,</span><span class="n">im</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
                                             <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">e</span>
                    <span class="k">del</span> <span class="n">im</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">time_index</span><span class="p">],</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">)</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="n">im</span><span class="p">,</span><span class="n">contour_levels</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                                           <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="o">**</span><span class="n">_plot_opt</span><span class="p">)</span>
                        <span class="k">del</span> <span class="n">im</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">e</span>
    
            <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Colorbar&#39;</span><span class="p">]):</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax_act</span><span class="p">)</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data_unit</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">xrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>        
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log x&#39;</span><span class="p">]):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Log y&#39;</span><span class="p">]):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span>  <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">exp_id</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; @ &#39;</span><span class="o">+</span><span class="n">coord_t</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;=&#39;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:10.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tdata</span><span class="p">[</span><span class="n">it</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; [&#39;</span><span class="o">+</span><span class="n">coord_t</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Waittime&#39;</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Video file&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cv2_presence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)):</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                <span class="c1"># Get the RGBA buffer from the figure</span>
                <span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_width_height</span><span class="p">()</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">tostring_rgb</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                <span class="n">buf</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
                <span class="n">buf</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_RGBA2BGR</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">video</span>
                <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                    <span class="n">height</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">width</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">video</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Video file&#39;</span><span class="p">],</span>  
                                            <span class="n">cv2</span><span class="o">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="o">*</span><span class="n">video_codec_code</span><span class="p">),</span> 
                                            <span class="nb">float</span><span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Video framerate&#39;</span><span class="p">]),</span> 
                                            <span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">),</span>
                                            <span class="n">isColor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">video</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Video file&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">cv2_presence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)):</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
            <span class="n">video</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>  
            <span class="k">del</span> <span class="n">video</span>
            
    <span class="k">elif</span> <span class="p">(</span><span class="n">_plot_type</span> <span class="o">==</span> <span class="s1">&#39;animation&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot plot DataObject without data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Animated image plot is applicable to 3D data only. Use slicing.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Animated image plot is applicable only to real data.&quot;</span><span class="p">)</span>
        <span class="c1"># Checking for numeric type</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Animated image plot is applicable only to numeric data.&quot;</span><span class="p">)</span>
        
        <span class="n">yrange</span> <span class="o">=</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Y range&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Y range setting.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">zrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Prevent saturation&#39;</span><span class="p">]):</span>
            <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">zrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Processing axes</span>
        <span class="c1"># Although the plot will be cleared the existing plot axes will be considered</span>
        <span class="n">default_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">d</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;__Data__&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdd_list</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">_plot_id</span><span class="o">.</span><span class="n">check_axes</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> 
                                                    <span class="n">axes</span><span class="p">,</span> 
                                                    <span class="n">clear</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Clear&#39;</span><span class="p">],</span> 
                                                    <span class="n">default_axes</span><span class="o">=</span><span class="n">default_axes</span><span class="p">,</span> 
                                                    <span class="n">force</span><span class="o">=</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Force axes&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">((</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Data</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data_object</span> <span class="o">==</span> <span class="n">d</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For the animation plot only data can be plotted on the z axis.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">!=</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">!=</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;X and y coordinates of the animation plot type should be coordinates.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pdd_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data_type</span> <span class="o">!=</span> <span class="n">PddType</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time coordinate of the animation plot should be flap.coordinate.&quot;</span><span class="p">)</span>

        <span class="n">coord_x</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">coord_y</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">coord_t</span> <span class="o">=</span> <span class="n">pdd_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_t</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time coordinate for anim-image/anim-contour plot should be changing only along one dimension.&quot;</span><span class="p">)</span>
            
        <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
        <span class="n">index</span><span class="p">[</span><span class="n">coord_t</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span>
        <span class="n">tdata</span> <span class="o">=</span> <span class="n">coord_t</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Coordinate &#39;</span><span class="o">+</span><span class="n">coord_y</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39; is not numeric.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">coord_x</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">coord_y</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="c1"># This data is image-like with data points on a rectangular array</span>
            <span class="n">image_like</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">coord_x</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Coordinate &#39;</span><span class="o">+</span><span class="n">coord_x</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39; is not numeric.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Coordinate &#39;</span><span class="o">+</span><span class="n">coord_y</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39; is not numeric.&#39;</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">index</span><span class="p">[</span><span class="n">coord_x</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span>
            <span class="n">xdata</span><span class="p">,</span><span class="n">xdata_low</span><span class="p">,</span><span class="n">xdata_high</span> <span class="o">=</span> <span class="n">coord_x</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">xdata</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">xdata</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">xdata</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">index</span><span class="p">[</span><span class="n">coord_y</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="o">...</span>
            <span class="n">ydata</span><span class="p">,</span><span class="n">ydata_low</span><span class="p">,</span><span class="n">ydata_high</span> <span class="o">=</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">ydata</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">ydata</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">dx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="n">dy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">dy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="c1"># Actually the non-equidistant coordinates are equidistant</span>
                <span class="n">image_like</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">image_like</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image_like</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">image_like</span><span class="p">):</span>        
            <span class="n">xdata_range</span> <span class="o">=</span> <span class="n">coord_x</span><span class="o">.</span><span class="n">data_range</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>   
            <span class="n">ydata_range</span> <span class="o">=</span> <span class="n">coord_y</span><span class="o">.</span><span class="n">data_range</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>   
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coord_y</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coord_x</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span>
            <span class="n">index</span><span class="p">[</span><span class="n">coord_t</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">xdata_range</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ydata_range</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coord_y</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coord_x</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data_shape</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmap_obj</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Nan color&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">cmap_obj</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Nan color&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid color map.&quot;</span><span class="p">)</span>

        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">subplot_spec</span><span class="o">=</span><span class="n">_plot_id</span><span class="o">.</span><span class="n">base_subplot</span><span class="p">)</span>

        <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_plot_id</span><span class="o">.</span><span class="n">plt_axis_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>

        <span class="n">oargs</span><span class="o">=</span><span class="p">(</span><span class="n">ax_list</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">tdata</span><span class="p">,</span> <span class="n">xdata_range</span><span class="p">,</span> <span class="n">ydata_range</span><span class="p">,</span>
               <span class="n">cmap_obj</span><span class="p">,</span> <span class="n">contour_levels</span><span class="p">,</span> 
               <span class="n">coord_t</span><span class="p">,</span> <span class="n">coord_x</span><span class="p">,</span> <span class="n">coord_y</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">_options</span><span class="p">,</span> 
               <span class="n">xrange</span><span class="p">,</span> <span class="n">yrange</span><span class="p">,</span> <span class="n">zrange</span><span class="p">,</span> <span class="n">image_like</span><span class="p">,</span> 
               <span class="n">_plot_options</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">_plot_id</span><span class="p">,</span> <span class="n">gs</span><span class="p">)</span>
        
        <span class="n">anim</span> <span class="o">=</span> <span class="n">PlotAnimation</span><span class="p">(</span><span class="o">*</span><span class="n">oargs</span><span class="p">)</span>
        <span class="n">anim</span><span class="o">.</span><span class="n">animate</span><span class="p">()</span>
        

<span class="c1">#    print(&quot;------ plot finished, show() ----&quot;)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>       
 
<span class="c1">#    if (_options[&#39;Clear&#39;]):</span>
<span class="c1">#        _plot_id.number_of_plots = 0</span>
<span class="c1">#        _plot_id.plot_data = []</span>
<span class="c1">#        _plot_id.plt_axis_list = None            </span>
<span class="c1">#    _plot_id.number_of_plots += 1</span>
    <span class="n">_plot_id</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">ax_list</span>
    <span class="n">_plot_id</span><span class="o">.</span><span class="n">plot_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdd_list</span><span class="p">)</span>
    <span class="c1">#Setting this one the default plot ID</span>
    <span class="n">_plot_id</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_options</span><span class="p">)</span>
    <span class="n">_plot_id</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="n">_plot_type</span>
    <span class="n">set_plot_id</span><span class="p">(</span><span class="n">_plot_id</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_plot_id</span>
</pre></div>

            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>