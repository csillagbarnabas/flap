
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>flap.coordinate &#8212; FLAP  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for flap.coordinate</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Wed Jan 23 09:44:50 2019</span>

<span class="sd">@author: Zoletnik</span>

<span class="sd">This is the coordinate description for FLAP</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">flap.tools</span>
<span class="kn">import</span> <span class="nn">flap.config</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>

<div class="viewcode-block" id="Intervals"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.Intervals">[docs]</a><span class="k">class</span> <span class="nc">Intervals</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; A class to describe a series of intervals.</span>
<span class="sd">        Regular intevals are identical length ones repeating with a fixed step.</span>
<span class="sd">        Irregulars are just a list of start-stop values.</span>
<span class="sd">        For integer type values both the start and stop value is included.</span>
<span class="sd">        The optional number gives the number of ranges for the regular intervals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">number</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           step: If not given the intervals are assumed to be irregular, othewise regular.</span>
<span class="sd">           start, stop: Regular case:</span>
<span class="sd">                           start and stop value of first interval</span>
<span class="sd">                        Irregular case:</span>
<span class="sd">                           start and stop value of all intervals. (Identical length numpy arrays.)</span>
<span class="sd">           number: The number of intervals in regular case. If not set the intervals continue indefinitely.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">regular</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">regular</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">regular</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Non-numeric type in selection interval.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">start</span> <span class="o">&gt;=</span> <span class="n">stop</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Bad interval decription: stop before start.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">start</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">start</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_start</span> <span class="o">=</span> <span class="n">start</span>
                <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">_start</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_start</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Start values should be 1D numpy array or scalar.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">_start</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">stop</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">stop</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_stop</span> <span class="o">=</span> <span class="n">stop</span>
                <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">_stop</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_stop</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Stop values should be 1D numpy array or scalar.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">_stop</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lenght of start and stop arrays should be identical.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Interval length should be positive.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Non-numeric type in selection interval.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">regular</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="Intervals.interval_limits"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.Intervals.interval_limits">[docs]</a>    <span class="k">def</span> <span class="nf">interval_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">partial_intervals</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the range lower and upper limits as two numpy arrays.</span>
<span class="sd">            Limit the ranges within argument limits. (limits[0] &lt; limits[1])</span>
<span class="sd">            limits: 2 elements list with lower and upper limit</span>

<span class="sd">            partial_intervals: Return also partial ranges which extend over limits.</span>
<span class="sd">                            Their size will be truncated.</span>

<span class="sd">            Raises a ValueError if there are no intervals within  limit or other problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">regular</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For the range limits either the number of intervals or limits must be set.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regular</span><span class="p">()):</span>
                <span class="n">range_starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
                <span class="n">range_stops</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
                <span class="k">return</span> <span class="n">range_starts</span><span class="p">,</span> <span class="n">range_stops</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
        <span class="n">number</span><span class="p">,</span> <span class="n">start_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interval_number</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span><span class="n">partial_intervals</span><span class="o">=</span><span class="n">partial_intervals</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No interval within limits.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regular</span><span class="p">()):</span>
            <span class="n">range_starts</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">+</span> <span class="n">start_interval</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
            <span class="n">range_stops</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">+</span> <span class="n">start_interval</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">range_starts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="n">start_interval</span><span class="p">:</span> <span class="n">start_interval</span> <span class="o">+</span> <span class="n">number</span><span class="p">]</span>
            <span class="n">range_stops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">[</span><span class="n">start_interval</span><span class="p">:</span> <span class="n">start_interval</span> <span class="o">+</span> <span class="n">number</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">partial_intervals</span><span class="p">):</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">range_stops</span> <span class="o">&gt;</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="n">range_starts</span> <span class="o">&lt;</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">range_starts</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">range_stops</span> <span class="o">&gt;</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                            <span class="n">range_starts</span> <span class="o">&lt;</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">range_stops</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">range_stops</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">range_starts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Internal error: selected intervals outside of limits.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">range_starts</span><span class="p">,</span> <span class="n">range_stops</span></div>

<div class="viewcode-block" id="Intervals.interval_number"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.Intervals.interval_number">[docs]</a>    <span class="k">def</span> <span class="nf">interval_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">partial_intervals</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the number of intervals and the index of the start interval.</span>
<span class="sd">            Limit the ranges within argument limits.</span>
<span class="sd">            limits: 2 elements list with lower and upper limit</span>

<span class="sd">            partial_intervals: Take into account also partial ranges which extend over limits.</span>

<span class="sd">            Raises a ValueError in case of problem.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">regular</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For the range limits either the number of intervals or limits must be set.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regular</span><span class="p">()):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regular</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>\
                <span class="ow">or</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]))):</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">partial_intervals</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">&lt;</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">start_interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">start_interval</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">interval_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="o">-</span> <span class="n">start_interval</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">start_interval</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">start_interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">interval_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="o">-</span> <span class="n">start_interval</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">partial_intervals</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">start_interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">start_interval</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">interval_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="o">-</span> <span class="n">start_interval</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">&gt;</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">start_interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">start_interval</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">interval_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="o">-</span> <span class="n">start_interval</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">start_interval</span> <span class="o">+</span> <span class="n">interval_n</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
                    <span class="n">interval_n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">-</span> <span class="n">start_interval</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">interval_n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">interval_n</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="n">interval_n</span><span class="p">,</span> <span class="n">start_interval</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">partial_intervals</span><span class="p">):</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">&gt;=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">&lt;=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ind</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div></div>

<div class="viewcode-block" id="Unit"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.Unit">[docs]</a><span class="k">class</span> <span class="nc">Unit</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Class for the unit of the data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
    
<div class="viewcode-block" id="Unit.title"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.Unit.title">[docs]</a>    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">language</span><span class="o">=</span><span class="s1">&#39;EN&#39;</span><span class="p">,</span><span class="n">complex_txt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">new_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a title string which will be used in plotting.</span>
<span class="sd">            complex_txt: List of 2 numbers:</span>
<span class="sd">                         [0,0]: Amplitude</span>
<span class="sd">                         [0,1]: Phase</span>
<span class="sd">                         [1,0]: Real</span>
<span class="sd">                         [1,1]: Imaginary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">language</span> <span class="o">==</span> <span class="s1">&#39;EN&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                <span class="n">unit_txt</span> <span class="o">=</span> <span class="s1">&#39; [a.u.]&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">new_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">unit_txt</span> <span class="o">=</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">unit_txt</span> <span class="o">=</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="n">new_unit</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">complex_txt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">complex_txt</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;Amplitude &#39;</span> <span class="o">+</span> <span class="n">unit_txt</span>
                    <span class="k">else</span><span class="p">:</span>    
                        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;Amplitude of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">unit_txt</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">complex_txt</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;Phase [rad]&#39;</span>
                    <span class="k">else</span><span class="p">:</span>    
                        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;Phase of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; [rad]&#39;</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">complex_txt</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;Real part &#39;</span> <span class="o">+</span> <span class="n">unit_txt</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;Real part of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">unit_txt</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">complex_txt</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;Imaginary part &#39;</span> <span class="o">+</span> <span class="n">unit_txt</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;Imaginary part of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">unit_txt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">unit_txt</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">language</span> <span class="o">==</span> <span class="s1">&#39;HU&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                <span class="n">unit_txt</span> <span class="o">=</span> <span class="s1">&#39; [tetsz. e.]&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unit_txt</span> <span class="o">=</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">complex_txt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">complex_txt</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span><span class="s1">&#39; amplitudo&#39;</span> <span class="o">+</span> <span class="n">unit_txt</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">complex_txt</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; fazis [rad]&#39;</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">complex_txt</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; valos resz&#39;</span> <span class="o">+</span> <span class="n">unit_txt</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">complex_txt</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; kepzetes resz&#39;</span><span class="o">+</span> <span class="n">unit_txt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">unit_txt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown language.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">txt</span></div></div>

<div class="viewcode-block" id="CoordinateMode"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.CoordinateMode">[docs]</a><span class="k">class</span> <span class="nc">CoordinateMode</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Class for storing mode flags of the coordinate description</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">equidistant</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">range_symmetric</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equidistant</span> <span class="o">=</span> <span class="n">equidistant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">range_symmetric</span> <span class="o">=</span> <span class="n">range_symmetric</span></div>


<div class="viewcode-block" id="Coordinate"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.Coordinate">[docs]</a><span class="k">class</span> <span class="nc">Coordinate</span><span class="p">:</span>
    <span class="c1"># These are bit flags for self.mode</span>
    <span class="sd">&quot;&quot;&quot; Class for the description of a mapping of coordinate values from an n-dimensional coordinate</span>
<span class="sd">        sample space to coordinates of an m-dimensional data matrix.</span>
<span class="sd">        Coordinate sample space is a rectangular equidistant point matrix, with equal steps in each dimension.</span>
<span class="sd">        For dimension i sample index is from 0...n-1 if shape[i] == n</span>
<span class="sd">        The sample space in this coordinate description does not necessarily match the shape of</span>
<span class="sd">        any sub-matrix of the data object. If the shape is different then interpolation is done assuming</span>
<span class="sd">        the coordinate of the first(last) point of the coordinate matrix is the coordinate of the first(last)</span>
<span class="sd">        data point.</span>

<span class="sd">        Coordinate can be anything described by name and unit.</span>
<span class="sd">        Standard coordinates: Time, Channel, Channel number, Device_x, Device_y, Device_z, Device_R, Device_Z, Device_phi,</span>
<span class="sd">                              Flux_r, Flux_theta, Flux_phi, Frequency, Time lag</span>

<span class="sd">        See the description of variables in the __init__ function.</span>
<span class="sd">        The ranges and start-step pair of inputs are alternatives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">mode</span><span class="o">=</span><span class="n">CoordinateMode</span><span class="p">(),</span>
                 <span class="n">shape</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">c_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">value_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">value_ranges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">dimension_list</span><span class="o">=</span><span class="p">[]):</span>
        <span class="c1"># This is a UnitClass describing the name and unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
        <span class="c1"># mode is a collection of flags</span>
        <span class="c1"># flap.Coordinate.EQUIDISTANT: coordinate changes proportionally to samples number</span>
        <span class="c1"># flap.Coordinate.RANGE_ASYMMETRIC: The range around the coordiantes is asymmetric described</span>
        <span class="c1">#                                   by lower and uper range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
        <span class="c1"># The shape of the sample space matrix in this coordinate description (tuple)</span>
        <span class="c1"># If len(shape) == 0 then the coordinate is the same for all samples and it is described by values and value_ranges</span>
        <span class="c1"># shape should not have a 1 element.</span>
        <span class="c1"># Actually in the equidistant case only the dimension of shape is used.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="c1"># start and step describes the coordinate mapping if EQUIDISTANT flag is set.</span>
        <span class="c1"># Start is scalar and step is a 1Dd list with the same number of elements as dimension_list.</span>
        <span class="c1"># Would have been good to use decimal.Decimal types but operations between float and Decimal</span>
        <span class="c1"># are not allowed, therefore using float</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Decimal</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Decimal</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>

        <span class="c1"># Values and value_index are valid only for non-equidistant axis</span>
        <span class="c1"># They describe the coordinate value at value_index in the coordinate matrix</span>
        <span class="c1"># sample values is a 2D array (len(shape) times N_sample) of indices to the coordinate matrix described by self.shape,</span>
        <span class="c1"># that is values_index[:,i] gives the coordinates of values[i] in the coordinate sample space.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_index</span> <span class="o">=</span> <span class="n">value_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="c1"># Value ranges is the range around the coordinate values. If mode.range_symmetric it is symmetric</span>
        <span class="c1"># around the values: [values-value_ranges, value+value_ranges] If not symmetric it is</span>
        <span class="c1"># [values-value_ranges_low, value+value_ranges_high]</span>
        <span class="c1"># If mode.equidistant:</span>
        <span class="c1">#     if mode.range_symmetric is False:</span>
        <span class="c1">#           value_ranges should be a 2 element array</span>
        <span class="c1">#     if mode.symmetric is True: value_ranges should be scalar</span>
        <span class="c1"># if mode.equidistant is False:</span>
        <span class="c1">#     if mode.range_symmetric is False:</span>
        <span class="c1">#           value_ranges should be a dictionary with keys &#39;low&#39;, &#39;high&#39;. Each value has</span>
        <span class="c1">#           the same dimensions as values,</span>
        <span class="c1">#     if mode.symmetric is True: value_ranges should have same shape as values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span> <span class="o">=</span> <span class="n">value_ranges</span>
        <span class="c1"># dimension_list: list of data dimensions for which this coordinate is related (0...)</span>
        <span class="c1"># len(dimension_list) should be equeal to len(shape)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span> <span class="o">=</span> <span class="n">dimension_list</span>
        <span class="c1"># c_range is just for specifiing a range when reading data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_range</span> <span class="o">=</span> <span class="n">c_range</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span>

    <span class="nd">@start</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">start</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__start</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Decimal</span><span class="p">):</span>
            <span class="n">_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="c1"># Checking this strange way to also enable numpy types</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_start</span><span class="p">])</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;c&#39;</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid coordinate start value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__start</span> <span class="o">=</span> <span class="n">_start</span>       

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__step</span>

    <span class="nd">@step</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">step</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__step</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">_step</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_step</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">_step</span> <span class="o">=</span> <span class="p">[</span><span class="n">_step</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_step</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_step</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="n">Decimal</span><span class="p">):</span>
                <span class="n">_step</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">_step</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_step</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;c&#39;</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid coordinate step value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__step</span> <span class="o">=</span> <span class="n">_step</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dimension_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dimension_list</span>

    <span class="nd">@dimension_list</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dimension_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dimension_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">dimension_list</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dimension_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">dimension_list</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dimension_list</span> <span class="o">=</span> <span class="n">dimension_list</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span>

    <span class="nd">@shape</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">shape</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span> <span class="o">=</span> <span class="n">shape</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; compares two coordinates assuming same data shape</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span> <span class="o">==</span> <span class="n">c1</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; compares two coordinates assuming same data shape</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">unit</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span> <span class="ow">and</span> <span class="n">c1</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">self_step</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">self_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">c1_step</span> <span class="o">=</span> <span class="p">[</span><span class="n">c1</span><span class="o">.</span><span class="n">step</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c1_step</span> <span class="o">=</span> <span class="n">c1</span><span class="o">.</span><span class="n">step</span>
            <span class="n">minstep</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">self_step</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>    
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">self_step</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">self_step</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1_step</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">self_step</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.00001</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">self_step</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">minstep</span><span class="p">):</span>
                    <span class="n">minstep</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">self_step</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="n">c1</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">minstep</span> <span class="o">&gt;</span> <span class="mf">0.00001</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">[]):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">value_ranges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">value_ranges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">range_symmetric</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">range_symmetric</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">range_symmetric</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">value_ranges</span><span class="o">.</span><span class="n">flatten</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="k">return</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="k">return</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
                    
<div class="viewcode-block" id="Coordinate.non_interpol"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.Coordinate.non_interpol">[docs]</a>    <span class="k">def</span> <span class="nf">non_interpol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return True if the shape of the coordinate description</span>
<span class="sd">            is the same as the sub-data-array for which it applies and self.value_index is None.</span>
<span class="sd">            In this case there is no need for interpolation, just copy coordinate values</span>

<span class="sd">            Applicable only for non-equidistant case.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">data_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># The shape for which the coordinate description applies</span>
        <span class="n">ds_coord</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_shape</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">]</span>
        <span class="c1"># Removing dimensions with one element</span>
        <span class="n">ds_coord</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ds_coord</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_coord</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">ds_coord</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ds_coord</span> <span class="o">==</span> <span class="n">shape</span></div>

<div class="viewcode-block" id="Coordinate.dtype"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.Coordinate.dtype">[docs]</a>    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the data type of the coordinate.</span>
<span class="sd">        Returns standard Python types: str, int, float, complex, boolean, object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Bad equidistant coordinate description: step or start is missing.&quot;</span><span class="p">)</span>
            <span class="c1"># Reporting int type only if both start and step is integer</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">])</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">:</span>
                <span class="n">kind_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="p">])</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">kind_step</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">):</span>
                    <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">kind_step</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">):</span>
                    <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;u&#39;</span><span class="p">)):</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">object</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unknown coordinate value type.&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">isnumeric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">dt</span> <span class="o">==</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dt</span> <span class="o">==</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dt</span> <span class="o">==</span> <span class="nb">complex</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dt</span> <span class="o">==</span> <span class="n">Decimal</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">string_subtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="Coordinate.change_dimensions"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.Coordinate.change_dimensions">[docs]</a>    <span class="k">def</span> <span class="nf">change_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the list of dimensions of the data array along which this coordinate</span>
<span class="sd">            changes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span></div>

<div class="viewcode-block" id="Coordinate.nochange_dimensions"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.Coordinate.nochange_dimensions">[docs]</a>    <span class="k">def</span> <span class="nf">nochange_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the list of dimensions of the data array along which this coordinate</span>
<span class="sd">            changes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_dimensions</span> <span class="o">==</span> <span class="p">[]):</span>

            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_shape</span><span class="p">)))</span>

        <span class="n">nochange_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_shape</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">nochange_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nochange_list</span></div>

<div class="viewcode-block" id="Coordinate.data"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.Coordinate.data">[docs]</a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the coordinates, low and high limits for a sub-array of the data array in a DataObject.</span>

<span class="sd">        index:</span>
<span class="sd">            list, tuple describing the elements in DataObject.data for which the coordinates are</span>
<span class="sd">            required. The length of the array should be identical to the number of dimensions</span>
<span class="sd">            of the data array. Elements can be a mixture of numbers, slice objects, lists, numpy arrays,</span>
<span class="sd">            integer iterators and ellipses.</span>
<span class="sd">            Examples for 3D array:</span>
<span class="sd">                (...,0,0) coordinates of the elements in the first row of the data array</span>
<span class="sd">                (slice(2,5),2,...)</span>
<span class="sd">        data_shape:</span>
<span class="sd">            The shape of the data array (without slicing) for which coordinates are requested.</span>
<span class="sd">        options: Dictionary with options for processing:</span>
<span class="sd">                   &#39;Interpolation&#39;: &#39;Linear&#39; (default, for non-equidistant axis when values shape is </span>
<span class="sd">                                              different from data shape)</span>
<span class="sd">                   &#39;Change only&#39;: Return only the data for those dimensions where this coordinate changes. </span>
<span class="sd">                                  E.g. if it changes only along one dimension the output array will have 1 element</span>
<span class="sd">                                  in all other dimensions.</span>

<span class="sd">        Return value:</span>
<span class="sd">            values, value_range_low, value range_high</span>
<span class="sd">            The low and high values are the absolute values not the difference from values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Interpolation&#39;</span><span class="p">:</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;Change only&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        
        <span class="n">_options</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">merge_options</span><span class="p">(</span><span class="n">default_options</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">data_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing data_shape argument in flap.Coordinate.data()&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data_shape</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">_data_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_data_shape</span> <span class="o">=</span> <span class="n">data_shape</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Change only&#39;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;index and &#39;Change only&#39; option cannot be used at the same time in Coordinate.data().&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Change only&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_dimensions</span> <span class="ow">is</span> <span class="p">[]):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="o">...</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_shape</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_dimensions</span><span class="p">():</span>
                    <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>            
        <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">index</span> <span class="ow">is</span> <span class="bp">Ellipsis</span><span class="p">):</span>
            <span class="n">_index</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">_index</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_index</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">_index</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_index</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_data_shape</span><span class="p">)):</span>
            <span class="k">raise</span> \
                <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incompatible data_shape and index arguments in flap.Coordinate.data()&quot;</span><span class="p">)</span>

        <span class="c1"># Determining the shape of the output array and the indices for selecting the output elements</span>
        <span class="c1"># from the data array (This will be needed for selecting the coordinates.)</span>
        <span class="c1"># Out_index will be a list of np.arrays</span>
        <span class="n">out_shape</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">_index</span><span class="p">)</span>
        <span class="n">out_index</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">_index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_index</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">Ellipsis</span><span class="p">):</span>
                <span class="n">out_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_data_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">out_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">_data_shape</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">out_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">))</span>
                <span class="n">out_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">_data_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]))))</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">range</span><span class="p">):</span>
                <span class="n">out_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">))</span>
                <span class="n">out_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">out_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">out_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">out_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">out_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="n">out_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">out_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_index</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># If coordinate is constant, returning it</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span><span class="p">):</span>
                <span class="n">out_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">out_shape</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">range_symmetric</span><span class="p">):</span>
                        <span class="n">vl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span>
                        <span class="n">vh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">vh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
                    <span class="n">vh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>

                <span class="n">out_coord_low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">out_shape</span><span class="p">),</span><span class="n">vl</span><span class="p">)</span>
                <span class="n">out_coord_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">out_shape</span><span class="p">),</span><span class="n">vh</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">out_coord</span><span class="p">,</span> <span class="n">out_coord_low</span><span class="p">,</span> <span class="n">out_coord_high</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
            <span class="n">out_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">out_shape</span><span class="p">),</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">vh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span><span class="ne">IndexError</span><span class="p">):</span>
                    <span class="n">vl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">vh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">out_coord_low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">out_shape</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">())</span> <span class="o">+</span> <span class="n">vl</span>
                <span class="n">out_coord_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">out_shape</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">())</span> <span class="o">+</span> <span class="n">vh</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_coord_low</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">out_coord_high</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">out_coord</span><span class="p">,</span> <span class="n">out_coord_low</span><span class="p">,</span> <span class="n">out_coord_high</span>

        <span class="c1"># Selecting those dimensions in _index where the coordinate changes</span>
        <span class="c1"># This is an index into the value array of the coordinate</span>
        <span class="n">value_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">out_index</span><span class="p">[</span><span class="n">di</span><span class="p">]</span> <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">]</span>
<span class="c1">#        value_index = []</span>
<span class="c1">#        for di in self.dimension_list:</span>
<span class="c1">#            value_index.append(out_index[di])</span>
        <span class="c1"># This will be the shape of the coordinate value matrix in the dimension_list</span>
        <span class="c1"># subspace of the output array with out_shape</span>
        <span class="n">value_mx_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">out_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span><span class="p">):</span>
           <span class="c1">#Equidistant</span>
           <span class="c1"># This will store the equidistant coordinate values for the selected part</span>
            <span class="n">value_mx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">value_mx_shape</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)):</span>
                <span class="c1"># Creating an array (value_mx_temp) which has the same shape as value_mx but contains</span>
                <span class="c1"># only the dependency of the coordinate on dimension i.</span>
                <span class="c1"># First determining the shape of an array which has the same number of dimensions</span>
                <span class="c1"># as value_mx and has the same number of elements in dimension i as value_mx, but only</span>
                <span class="c1"># in all other dimensions.</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span>
                <span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_mx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># Creating an index array which indexes into all elements in dimension i but to element</span>
                <span class="c1"># 0 in all other dimensions</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">value_mx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="c1"># Creating value_ms_tmp as described above</span>
                <span class="n">value_mx_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">value_mx</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                <span class="c1"># Creating the coordinate dependency and putting it into value_mx_tmp</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">value_index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="c1">#                if (x.dtype is not np.dtype(np.float64)):</span>
<span class="c1">#                    x = x.astype(float)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                    <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
                <span class="n">value_mx_tmp</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">st</span>
                <span class="c1"># extending to the shape of value_mx</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">):</span>
                        <span class="n">value_mx_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">value_mx_tmp</span><span class="p">,</span><span class="n">value_mx_shape</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">j</span><span class="p">)</span>
                <span class="c1"># Adding to value_mx</span>
                <span class="n">value_mx</span> <span class="o">+=</span> <span class="n">value_mx_tmp</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">range_symmetric</span><span class="p">):</span>
                    <span class="n">value_mx_low</span> <span class="o">=</span> <span class="n">value_mx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span>
                    <span class="n">value_mx_high</span> <span class="o">=</span> <span class="n">value_mx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value_mx_low</span> <span class="o">=</span> <span class="n">value_mx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">value_mx_high</span> <span class="o">=</span> <span class="n">value_mx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value_mx_low</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">value_mx_high</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Non-equidistant</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_interpol</span><span class="p">(</span><span class="n">_data_shape</span><span class="p">)):</span>
                <span class="c1"># Number of non-equidistant elements equals the elements in data array</span>
                <span class="c1">#   --&gt; no interpolation is necessary</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value_index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="n">value_index_arrays</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">submatrix_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">value_index</span><span class="p">)</span>
                <span class="n">value_mx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="n">value_index_arrays</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">_value_ranges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">range_symmetric</span><span class="p">):</span>
                        <span class="n">value_mx_low</span> <span class="o">=</span> <span class="n">value_mx</span> <span class="o">-</span> <span class="n">_value_ranges</span><span class="p">[</span><span class="n">value_index_arrays</span><span class="p">]</span>
                        <span class="n">value_mx_high</span> <span class="o">=</span> <span class="n">value_mx</span> <span class="o">+</span> <span class="n">_value_ranges</span><span class="p">[</span><span class="n">value_index_arrays</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value_mx_low</span> <span class="o">=</span> <span class="n">value_mx</span> <span class="o">-</span> <span class="n">_value_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">value_index_arrays</span><span class="p">]</span>
                        <span class="n">value_mx_high</span> <span class="o">=</span> <span class="n">value_mx</span> <span class="o">+</span> <span class="n">_value_ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">value_index_arrays</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value_mx_low</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">value_mx_high</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Interpolation is necesary</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                       <span class="s2">&quot;Interpolating for coordinate determination is not implemented yet.&quot;</span><span class="p">)</span>

        <span class="c1"># Extending value_mx and like to the output shape</span>
        <span class="c1"># First creating a dimension list where this coordinate does not change</span>
        <span class="n">nochange_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nochange_dimensions</span><span class="p">(</span><span class="n">_data_shape</span><span class="p">)</span>
        <span class="c1"># If this list is empty, nothing to be done</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nochange_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">out_coord</span> <span class="o">=</span> <span class="n">value_mx</span>
            <span class="n">out_coord_low</span> <span class="o">=</span> <span class="n">value_mx_low</span>
            <span class="n">out_coord_high</span> <span class="o">=</span> <span class="n">value_mx_high</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if we need to extend along the dimensions not in dimension_list</span>
            <span class="n">out_coord</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">expand_matrix</span><span class="p">(</span><span class="n">value_mx</span><span class="p">,</span><span class="n">out_shape</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">value_mx_low</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out_coord_low</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">expand_matrix</span><span class="p">(</span><span class="n">value_mx_low</span><span class="p">,</span><span class="n">out_shape</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_coord_low</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">value_mx_high</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">out_coord_high</span> <span class="o">=</span> <span class="n">flap</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">expand_matrix</span><span class="p">(</span><span class="n">value_mx_high</span><span class="p">,</span><span class="n">out_shape</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_coord_high</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">out_coord</span><span class="p">,</span> <span class="n">out_coord_low</span><span class="p">,</span> <span class="n">out_coord_high</span></div>

<div class="viewcode-block" id="Coordinate.data_range"><a class="viewcode-back" href="../../coordinate.html#flap.coordinate.Coordinate.data_range">[docs]</a>    <span class="k">def</span> <span class="nf">data_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the data range and the data range with errors for the coordinate. Both are lists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">data_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing data_shape argument in flap.Coordinate.data()&quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">equidistant</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">range_symmetric</span><span class="p">):</span>
                        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

            <span class="c1"># Calculating the coordinates of the corner points in the multi-dimensional space</span>
            <span class="n">corner_coords</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">data_shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">)):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corner_coords</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i_n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">corner_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corner_coords</span><span class="p">[</span><span class="n">i_n</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">data_shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_list</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">value_range</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">corner_coords</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">corner_coords</span><span class="p">)]</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">value_range_error</span> <span class="o">=</span> <span class="p">[</span><span class="n">value_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="n">value_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value_range_error</span> <span class="o">=</span> <span class="p">[</span><span class="n">value_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">,</span>
                                         <span class="n">value_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value_range_error</span> <span class="o">=</span> <span class="n">value_range</span>
            <span class="k">return</span> <span class="n">value_range</span><span class="p">,</span> <span class="n">value_range_error</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_interpol</span><span class="p">(</span><span class="n">data_shape</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Interpolating coordinate description is not implemented.&quot;</span><span class="p">)</span>
            <span class="n">value_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)]</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">value_range_error</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value_range_error</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">value_ranges</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value_range_error</span> <span class="o">=</span> <span class="n">value_range</span>
            <span class="k">return</span> <span class="n">value_range</span><span class="p">,</span> <span class="n">value_range_error</span></div></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">FLAP</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../styleguide.html">FLAP Styleguide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sourcecode.html">FLAP source code documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage of FLAP (tips/tricks/faq)</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, S. Zoletnik et al..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>